<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Week 4: Data Wrangling</title>
    <meta charset="utf-8" />
    <meta name="author" content="Joe Nese" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <script src="libs/freezeframe/freezeframe.min.js"></script>
    <script src="libs/xaringanExtra-freezeframe/freezeframe-init.js"></script>
    <script id="xaringanExtra-freezeframe-options" type="application/json">{"selector":"img[src$=\"gif\"]","trigger":"click","overlay":false,"responsive":true,"warnings":true}</script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Week 4: Data Wrangling
## <code>{dplyr}</code>
### Joe Nese
### University of Oregon
### Fall 2021

---








---
class: inverse, left, middle

# Data Wrangling with `{dplyr}`
## Week 4

---

# Agenda

*

**Overall Purpose**

* 

---
background-size: contain

background-image: url("https://www.ltd.org/files/library/bus-with-rainbow_lb.jpg")

---

background-size: contain

background-image: url("https://www.tidyverse.org/images/tidyverse-default.png")

---

# Providing grammar for:

* Graphics 
  + `{ggplot2}`
* Data manipulations 
  + `{dplyr}`
  + `{tidyr}`
* Expanding area of specialized topics
  + `{lubridate}`
  + `{glue}`
  + `{tidymodels}`
* Many more...

---

# Providing grammar for:

* Graphics 
  + `{ggplot2}`
* Data manipulations
  + .lightblue.bg-yellow[`{dplyr}`]
  + `{tidyr}`
* Expanding area of specialized topics
  + `{lubridate}`
  + `{glue}`
  + `{tidymodels}`
* Many more...


---
class: inverse, left, middle

# `{dplyr}`

---

# `{dplyr}`

&lt;div&gt;
    &lt;p style="float: right;"&gt;&lt;img src="https://d33wubrfki0l68.cloudfront.net/621a9c8c5d7b47c4b6d72e8f01f28d14310e8370/193fc/css/images/hex/dplyr.png" width="100" height="100"&gt;&lt;/p&gt;
    &lt;p&gt;A grammar for data wrangling (verbs!)&lt;/p&gt;
&lt;/div&gt;

Take a minute with your neighbor to guess what the following functions do:
* `select()`
* `filter()`
* `mutate()`
* `arrange()`
* `summarize()`
* `group_by()`

---

# `{dplyr}`

A grammar for data wrangling (verbs!)

* `select()`
--
  + a subset of **columns**
--
* `filter()`
--
  + a subset of **rows**
--
* `mutate()`
--
  + **add** a new column or **modify** an existing column
--
* `arrange()`
--
  + order rows in ascending/descending order
--
* `summarize()`
--
  + a column created according to other columns
  + for example: `mean()` or `sd()`
  + often used with...
--
* `group_by()`

---

# Arguments

* **`{dplyr}` always takes a data frame (tibble) as the first argument**
  + just like `{ggplot}`
* subsequent argument tell `{dplyr}` what to do with the data frame
* returns the modified data frame

---

# `select()`


```r
select(df, a, c)
```

![](https://swcarpentry.github.io/r-novice-gapminder/fig/13-dplyr-fig1.png)

.footnote[
Image from [Software Carpentry](https://swcarpentry.github.io/r-novice-gapminder/fig/13-dplyr-fig1.png)
]

---

# `filter()`


```r
filter(df,
       type == "otter",
       site == "bay")
```

![](https://raw.githubusercontent.com/allisonhorst/stats-illustrations/master/rstats-artwork/dplyr_filter.jpg)

.footnote[
Illustration by [Allison Horst](https://github.com/allisonhorst/stats-illustrations/)
]

---

# Examples

Let’s start with the presidential dataset from the {mdsr} package


```r
library(tidyverse)
#install.packages("mdsr")
library(mdsr)
presidential
```

```
## # A tibble: 11 x 4
##    name       start      end        party     
##    &lt;chr&gt;      &lt;date&gt;     &lt;date&gt;     &lt;chr&gt;     
##  1 Eisenhower 1953-01-20 1961-01-20 Republican
##  2 Kennedy    1961-01-20 1963-11-22 Democratic
##  3 Johnson    1963-11-22 1969-01-20 Democratic
##  4 Nixon      1969-01-20 1974-08-09 Republican
##  5 Ford       1974-08-09 1977-01-20 Republican
##  6 Carter     1977-01-20 1981-01-20 Democratic
##  7 Reagan     1981-01-20 1989-01-20 Republican
##  8 Bush       1989-01-20 1993-01-20 Republican
##  9 Clinton    1993-01-20 2001-01-20 Democratic
## 10 Bush       2001-01-20 2009-01-20 Republican
## 11 Obama      2009-01-20 2017-01-20 Democratic
```

---

# `select` president name and party


```r
select(presidential, name, party)
```
**OR** more typically

```r
presidential %&gt;%
	select(name, party)
```

```
## # A tibble: 11 x 2
##    name       party     
##    &lt;chr&gt;      &lt;chr&gt;     
##  1 Eisenhower Republican
##  2 Kennedy    Democratic
##  3 Johnson    Democratic
##  4 Nixon      Republican
##  5 Ford       Republican
##  6 Carter     Democratic
##  7 Reagan     Republican
##  8 Bush       Republican
##  9 Clinton    Democratic
## 10 Bush       Republican
## 11 Obama      Democratic
```

---

# Negation `-`


```r
select(presidential, -start)
```
**OR**

```r
presidential %&gt;%
	select(-start)
```

```
## # A tibble: 11 x 3
##    name       end        party     
##    &lt;chr&gt;      &lt;date&gt;     &lt;chr&gt;     
##  1 Eisenhower 1961-01-20 Republican
##  2 Kennedy    1963-11-22 Democratic
##  3 Johnson    1969-01-20 Democratic
##  4 Nixon      1974-08-09 Republican
##  5 Ford       1977-01-20 Republican
##  6 Carter     1981-01-20 Democratic
##  7 Reagan     1989-01-20 Republican
##  8 Bush       1993-01-20 Republican
##  9 Clinton    2001-01-20 Democratic
## 10 Bush       2009-01-20 Republican
## 11 Obama      2017-01-20 Democratic
```

---

# Indexing


```r
select(presidential, 1:3)
```
**OR**

```r
presidential %&gt;%
	select(1:3)
```

```
## # A tibble: 11 x 3
##    name       start      end       
##    &lt;chr&gt;      &lt;date&gt;     &lt;date&gt;    
##  1 Eisenhower 1953-01-20 1961-01-20
##  2 Kennedy    1961-01-20 1963-11-22
##  3 Johnson    1963-11-22 1969-01-20
##  4 Nixon      1969-01-20 1974-08-09
##  5 Ford       1974-08-09 1977-01-20
##  6 Carter     1977-01-20 1981-01-20
##  7 Reagan     1981-01-20 1989-01-20
##  8 Bush       1989-01-20 1993-01-20
##  9 Clinton    1993-01-20 2001-01-20
## 10 Bush       2001-01-20 2009-01-20
## 11 Obama      2009-01-20 2017-01-20
```

---

# Use multiple methods


```r
select(presidential, name, 2, 4)
```
**OR**

```r
presidential %&gt;%
	select(name, 2, 4)
```

```
## # A tibble: 11 x 3
##    name       start      party     
##    &lt;chr&gt;      &lt;date&gt;     &lt;chr&gt;     
##  1 Eisenhower 1953-01-20 Republican
##  2 Kennedy    1961-01-20 Democratic
##  3 Johnson    1963-11-22 Democratic
##  4 Nixon      1969-01-20 Republican
##  5 Ford       1974-08-09 Republican
##  6 Carter     1977-01-20 Democratic
##  7 Reagan     1981-01-20 Republican
##  8 Bush       1989-01-20 Republican
##  9 Clinton    1993-01-20 Democratic
## 10 Bush       2001-01-20 Republican
## 11 Obama      2009-01-20 Democratic
```

---

# Use `select` to order columns


```r
library(fivethirtyeight)
college_grad_students
```

```
## # A tibble: 173 x 22
##    major_code major     major_category    grad_total grad_sample_size grad_employed grad_employed_fu~ grad_unemployed grad_unemployme~ grad_p25th
##         &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;                  &lt;int&gt;            &lt;int&gt;         &lt;int&gt;             &lt;int&gt;           &lt;int&gt;            &lt;dbl&gt;      &lt;dbl&gt;
##  1       5601 Construc~ Industrial Arts ~       9173              200          7098              6511             681           0.0875     110000
##  2       6004 Commerci~ Arts                   53864              882         40492             29553            2482           0.0578      89000
##  3       6211 Hospital~ Business               24417              437         18368             14784            1465           0.0739     100000
##  4       2201 Cosmetol~ Industrial Arts ~       5411               72          3590              2701             316           0.0809      85000
##  5       2001 Communic~ Computers &amp; Math~       9109              171          7512              5622             466           0.0584      83700
##  6       3201 Court Re~ Law &amp; Public Pol~       1542               22          1008               860               0           0          120000
##  7       6206 Marketin~ Business              190996             3738        151570            123045            8324           0.0521     120000
##  8       1101 Agricult~ Agriculture &amp; Na~      17488              386         13104             11207             473           0.0348     100000
##  9       2101 Computer~ Computers &amp; Math~       5611               98          4716              3981             119           0.0246     114000
## 10       1904 Advertis~ Communications &amp;~      33928              688         28517             22523             899           0.0306      90000
## # ... with 163 more rows, and 12 more variables: grad_median &lt;dbl&gt;, grad_p75th &lt;int&gt;, nongrad_total &lt;int&gt;, nongrad_employed &lt;int&gt;,
## #   nongrad_employed_fulltime_yearround &lt;int&gt;, nongrad_unemployed &lt;int&gt;, nongrad_unemployment_rate &lt;dbl&gt;, nongrad_p25th &lt;dbl&gt;,
## #   nongrad_median &lt;dbl&gt;, nongrad_p75th &lt;dbl&gt;, grad_share &lt;dbl&gt;, grad_premium &lt;dbl&gt;
```

---

# Use `select` to order columns


```r
college_grad_students %&gt;%
	select(major_code, grad_total, grad_sample_size, everything())
```

```
## # A tibble: 173 x 22
##    major_code grad_total grad_sample_size major     major_category    grad_employed grad_employed_fu~ grad_unemployed grad_unemployme~ grad_p25th
##         &lt;int&gt;      &lt;int&gt;            &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;                     &lt;int&gt;             &lt;int&gt;           &lt;int&gt;            &lt;dbl&gt;      &lt;dbl&gt;
##  1       5601       9173              200 Construc~ Industrial Arts ~          7098              6511             681           0.0875     110000
##  2       6004      53864              882 Commerci~ Arts                      40492             29553            2482           0.0578      89000
##  3       6211      24417              437 Hospital~ Business                  18368             14784            1465           0.0739     100000
##  4       2201       5411               72 Cosmetol~ Industrial Arts ~          3590              2701             316           0.0809      85000
##  5       2001       9109              171 Communic~ Computers &amp; Math~          7512              5622             466           0.0584      83700
##  6       3201       1542               22 Court Re~ Law &amp; Public Pol~          1008               860               0           0          120000
##  7       6206     190996             3738 Marketin~ Business                 151570            123045            8324           0.0521     120000
##  8       1101      17488              386 Agricult~ Agriculture &amp; Na~         13104             11207             473           0.0348     100000
##  9       2101       5611               98 Computer~ Computers &amp; Math~          4716              3981             119           0.0246     114000
## 10       1904      33928              688 Advertis~ Communications &amp;~         28517             22523             899           0.0306      90000
## # ... with 163 more rows, and 12 more variables: grad_median &lt;dbl&gt;, grad_p75th &lt;int&gt;, nongrad_total &lt;int&gt;, nongrad_employed &lt;int&gt;,
## #   nongrad_employed_fulltime_yearround &lt;int&gt;, nongrad_unemployed &lt;int&gt;, nongrad_unemployment_rate &lt;dbl&gt;, nongrad_p25th &lt;dbl&gt;,
## #   nongrad_median &lt;dbl&gt;, nongrad_p75th &lt;dbl&gt;, grad_share &lt;dbl&gt;, grad_premium &lt;dbl&gt;
```

`everything()` is a helper verb that includes all column names

---

# `select()` [helper](https://tidyselect.r-lib.org/reference/select_helpers.html) functions

* `everything()`
* `starts_with()`
* `ends_with()`
* `contains()`
* `all_of()`
* `any_of()`

---

# `starts_with()`


```r
reads &lt;- read_csv(here("data", "Project_Reads_Scores.csv")) %&gt;% 
  clean_names()

reads %&gt;% 
    select(starts_with("test"))
```

```
## # A tibble: 48 x 3
##    test_year              test_type test_site
##    &lt;chr&gt;                  &lt;chr&gt;     &lt;chr&gt;    
##  1 06/01/2016 12:00:00 AM YEAR END  VIRDEN   
##  2 06/01/2016 12:00:00 AM YEAR END  VIRDEN   
##  3 06/01/2016 12:00:00 AM YEAR END  VIRDEN   
##  4 06/01/2016 12:00:00 AM YEAR END  VIRDEN   
##  5 06/01/2016 12:00:00 AM YEAR END  VIRDEN   
##  6 06/01/2016 12:00:00 AM YEAR END  VIRDEN   
##  7 06/01/2016 12:00:00 AM YEAR END  VIRDEN   
##  8 06/01/2016 12:00:00 AM YEAR END  VIRDEN   
##  9 06/01/2016 12:00:00 AM YEAR END  VIRDEN   
## 10 06/01/2016 12:00:00 AM YEAR END  VIRDEN   
## # ... with 38 more rows
```

---

# `ends_with()`


```r
reads %&gt;% 
    select(ends_with("score"))
```

```
## # A tibble: 48 x 10
##    pre_test_score post_test_score unit_1_score unit_2_score unit_3_score unit_4_score unit_5_6_score unit_7_score unit_8_score total_score
##             &lt;dbl&gt;           &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;          &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;
##  1             43              92            3            4            6            8             11           22           18         207
##  2             46             104            5            5            6            8             11           20           19         224
##  3             39              75            4            4            6            9             16           19           21         193
##  4             35             115            4            4            6           10             13           18           18         223
##  5             46              85            2            5            6            7             12           19           16         198
##  6             35              91            5            5            7            7             18           23           19         210
##  7             40              96            5            5            6            7             11           21           20         211
##  8             39              74            4            5            5            8             12           16           17         180
##  9             40              90            6            4            5            8             15           18           20         206
## 10             45              86            4            5            5            7             14           21           19         206
## # ... with 38 more rows
```

---

# `contains()`


```r
reads %&gt;% 
    select(contains("test"))
```

```
## # A tibble: 48 x 7
##    test_year              test_type test_site pre_test_score pre_test_percent post_test_score post_test_percent
##    &lt;chr&gt;                  &lt;chr&gt;     &lt;chr&gt;              &lt;dbl&gt; &lt;chr&gt;                      &lt;dbl&gt; &lt;chr&gt;            
##  1 06/01/2016 12:00:00 AM YEAR END  VIRDEN                43 29%                           92 61%              
##  2 06/01/2016 12:00:00 AM YEAR END  VIRDEN                46 31%                          104 69%              
##  3 06/01/2016 12:00:00 AM YEAR END  VIRDEN                39 26%                           75 50%              
##  4 06/01/2016 12:00:00 AM YEAR END  VIRDEN                35 23%                          115 77%              
##  5 06/01/2016 12:00:00 AM YEAR END  VIRDEN                46 31%                           85 57%              
##  6 06/01/2016 12:00:00 AM YEAR END  VIRDEN                35 23%                           91 61%              
##  7 06/01/2016 12:00:00 AM YEAR END  VIRDEN                40 27%                           96 64%              
##  8 06/01/2016 12:00:00 AM YEAR END  VIRDEN                39 26%                           74 49%              
##  9 06/01/2016 12:00:00 AM YEAR END  VIRDEN                40 27%                           90 60%              
## 10 06/01/2016 12:00:00 AM YEAR END  VIRDEN                45 30%                           86 57%              
## # ... with 38 more rows
```

---

# `all_of()`


```r
vars &lt;- c("pre_test_score", "pre_test_percent", "post_test_score", "post_test_percent")
```

.left_pull[

```r
reads %&gt;% 
    select(all_of(vars))
```

```
## # A tibble: 48 x 4
##    pre_test_score pre_test_percent post_test_score post_test_percent
##             &lt;dbl&gt; &lt;chr&gt;                      &lt;dbl&gt; &lt;chr&gt;            
##  1             43 29%                           92 61%              
##  2             46 31%                          104 69%              
##  3             39 26%                           75 50%              
##  4             35 23%                          115 77%              
##  5             46 31%                           85 57%              
##  6             35 23%                           91 61%              
##  7             40 27%                           96 64%              
##  8             39 26%                           74 49%              
##  9             40 27%                           90 60%              
## 10             45 30%                           86 57%              
## # ... with 38 more rows
```
]

--

.right-pull[

```r
*mpg %&gt;%
    select(all_of(vars))
```

```
## Error: Can't subset columns that don't exist.
## x Columns `pre_test_score`, `pre_test_percent`, `post_test_score`, and `post_test_percent` don't exist.
```
]

---

# `any_of()`

.left_pull[

```r
reads %&gt;% 
    select(any_of(vars))
```

```
## # A tibble: 48 x 4
##    pre_test_score pre_test_percent post_test_score post_test_percent
##             &lt;dbl&gt; &lt;chr&gt;                      &lt;dbl&gt; &lt;chr&gt;            
##  1             43 29%                           92 61%              
##  2             46 31%                          104 69%              
##  3             39 26%                           75 50%              
##  4             35 23%                          115 77%              
##  5             46 31%                           85 57%              
##  6             35 23%                           91 61%              
##  7             40 27%                           96 64%              
##  8             39 26%                           74 49%              
##  9             40 27%                           90 60%              
## 10             45 30%                           86 57%              
## # ... with 38 more rows
```
]

--

.right-pull[

```r
*mpg %&gt;%
    select(any_of(vars))
```

```
## # A tibble: 234 x 0
```
]

---

# Mix `select` methods and helpers

You can mix types and helper functions


```r
reads %&gt;% 
    select(student_id, 1, starts_with("total"))
```

```
## # A tibble: 48 x 4
##    student_id test_year              total_score total_percent_correct
##    &lt;chr&gt;      &lt;chr&gt;                        &lt;dbl&gt; &lt;chr&gt;                
##  1 Virden 1   06/01/2016 12:00:00 AM         207 41%                  
##  2 Virden 2   06/01/2016 12:00:00 AM         224 45%                  
##  3 Virden 3   06/01/2016 12:00:00 AM         193 39%                  
##  4 Virden 4   06/01/2016 12:00:00 AM         223 45%                  
##  5 Virden 5   06/01/2016 12:00:00 AM         198 40%                  
##  6 Virden 6   06/01/2016 12:00:00 AM         210 42%                  
##  7 Virden 7   06/01/2016 12:00:00 AM         211 42%                  
##  8 Virden 8   06/01/2016 12:00:00 AM         180 36%                  
##  9 Virden 9   06/01/2016 12:00:00 AM         206 41%                  
## 10 Virden 10  06/01/2016 12:00:00 AM         206 41%                  
## # ... with 38 more rows
```

---

# Mix `select` methods and helpers

You can also use select to rearrange your columns


```r
reads %&gt;% 
    select(student_id, 1, starts_with("total"), everything())
```

```
## # A tibble: 48 x 25
##    student_id test_year              total_score total_percent_c~ test_type test_site pre_test_score pre_test_percent post_test_score post_test_perce~
##    &lt;chr&gt;      &lt;chr&gt;                        &lt;dbl&gt; &lt;chr&gt;            &lt;chr&gt;     &lt;chr&gt;              &lt;dbl&gt; &lt;chr&gt;                      &lt;dbl&gt; &lt;chr&gt;           
##  1 Virden 1   06/01/2016 12:00:00 AM         207 41%              YEAR END  VIRDEN                43 29%                           92 61%             
##  2 Virden 2   06/01/2016 12:00:00 AM         224 45%              YEAR END  VIRDEN                46 31%                          104 69%             
##  3 Virden 3   06/01/2016 12:00:00 AM         193 39%              YEAR END  VIRDEN                39 26%                           75 50%             
##  4 Virden 4   06/01/2016 12:00:00 AM         223 45%              YEAR END  VIRDEN                35 23%                          115 77%             
##  5 Virden 5   06/01/2016 12:00:00 AM         198 40%              YEAR END  VIRDEN                46 31%                           85 57%             
##  6 Virden 6   06/01/2016 12:00:00 AM         210 42%              YEAR END  VIRDEN                35 23%                           91 61%             
##  7 Virden 7   06/01/2016 12:00:00 AM         211 42%              YEAR END  VIRDEN                40 27%                           96 64%             
##  8 Virden 8   06/01/2016 12:00:00 AM         180 36%              YEAR END  VIRDEN                39 26%                           74 49%             
##  9 Virden 9   06/01/2016 12:00:00 AM         206 41%              YEAR END  VIRDEN                40 27%                           90 60%             
## 10 Virden 10  06/01/2016 12:00:00 AM         206 41%              YEAR END  VIRDEN                45 30%                           86 57%             
## # ... with 38 more rows, and 15 more variables: percentage_change &lt;chr&gt;, unit_1_score &lt;dbl&gt;, unit_1_percent &lt;chr&gt;, unit_2_score &lt;dbl&gt;,
## #   unit_2_percent &lt;chr&gt;, unit_3_score &lt;dbl&gt;, unit_3_percent &lt;chr&gt;, unit_4_score &lt;dbl&gt;, unit_4_percent &lt;chr&gt;, unit_5_6_score &lt;dbl&gt;,
## #   unit_5_6_percent &lt;chr&gt;, unit_7_score &lt;dbl&gt;, unit_7_percent &lt;chr&gt;, unit_8_score &lt;dbl&gt;, unit_8_percent &lt;chr&gt;
```

---

# `relocate()`

.darkorange[`relocate(`].lightblue[`.data`]`, ...` .green[`before`]` = NULL, `lightorange[`.after`]` = NULL)`

lightblue[`.data`] = dataframe/tibble
`...` = columns to move
.green[`.before`] = variable to move *before*
lightorange[`.after`] = variable to move *after*
- supplying neither .green[`.before`] nor lightorange[`.after`] move columns to the left-hand side
- specifying both is an error

---

# `relocate()`


```r
presidential %&gt;% 
  relocate(party)
```

```
## # A tibble: 11 x 4
##    party      name       start      end       
##    &lt;chr&gt;      &lt;chr&gt;      &lt;date&gt;     &lt;date&gt;    
##  1 Republican Eisenhower 1953-01-20 1961-01-20
##  2 Democratic Kennedy    1961-01-20 1963-11-22
##  3 Democratic Johnson    1963-11-22 1969-01-20
##  4 Republican Nixon      1969-01-20 1974-08-09
##  5 Republican Ford       1974-08-09 1977-01-20
##  6 Democratic Carter     1977-01-20 1981-01-20
##  7 Republican Reagan     1981-01-20 1989-01-20
##  8 Republican Bush       1989-01-20 1993-01-20
##  9 Democratic Clinton    1993-01-20 2001-01-20
## 10 Republican Bush       2001-01-20 2009-01-20
## 11 Democratic Obama      2009-01-20 2017-01-20
```

.footnote[
moves "party" to far left (default)
]

---

# `relocate()`


```r
presidential %&gt;% 
  relocate(party, .after = start)
```

```
## # A tibble: 11 x 4
##    name       start      party      end       
##    &lt;chr&gt;      &lt;date&gt;     &lt;chr&gt;      &lt;date&gt;    
##  1 Eisenhower 1953-01-20 Republican 1961-01-20
##  2 Kennedy    1961-01-20 Democratic 1963-11-22
##  3 Johnson    1963-11-22 Democratic 1969-01-20
##  4 Nixon      1969-01-20 Republican 1974-08-09
##  5 Ford       1974-08-09 Republican 1977-01-20
##  6 Carter     1977-01-20 Democratic 1981-01-20
##  7 Reagan     1981-01-20 Republican 1989-01-20
##  8 Bush       1989-01-20 Republican 1993-01-20
##  9 Clinton    1993-01-20 Democratic 2001-01-20
## 10 Bush       2001-01-20 Republican 2009-01-20
## 11 Obama      2009-01-20 Democratic 2017-01-20
```

.footnote[
moves "party" after "start"
]

---

# `relocate()`


```r
presidential %&gt;% 
  relocate(end, .before = party)
```

```
## # A tibble: 11 x 4
##    name       start      end        party     
##    &lt;chr&gt;      &lt;date&gt;     &lt;date&gt;     &lt;chr&gt;     
##  1 Eisenhower 1953-01-20 1961-01-20 Republican
##  2 Kennedy    1961-01-20 1963-11-22 Democratic
##  3 Johnson    1963-11-22 1969-01-20 Democratic
##  4 Nixon      1969-01-20 1974-08-09 Republican
##  5 Ford       1974-08-09 1977-01-20 Republican
##  6 Carter     1977-01-20 1981-01-20 Democratic
##  7 Reagan     1981-01-20 1989-01-20 Republican
##  8 Bush       1989-01-20 1993-01-20 Republican
##  9 Clinton    1993-01-20 2001-01-20 Democratic
## 10 Bush       2001-01-20 2009-01-20 Republican
## 11 Obama      2009-01-20 2017-01-20 Democratic
```

.footnote[
moves "end" before "party"
]

---

# `filter()`

![](https://d33wubrfki0l68.cloudfront.net/01f4b6d39d2be8269740a3ad7946faa79f7243cf/8369a/diagrams/transform-logical.png)

Complete set of boolean operations
- *x* is the left-hand circle
- *y* is the right-hand circle
- the shaded region show which parts each operator selects
  + *xor* == *x* or *y* except where they overlap

.footnote[
Image from [Wickham &amp; Grolemund (2017)](https://r4ds.had.co.nz/transform.html?q=filter#filter-rows-with-filter)
]

---

# `filter()` numeric

.pull-left[

```r
mpg %&gt;% 
  filter(cyl == 4)
```

```
## # A tibble: 81 x 11
##    manufacturer model      displ  year   cyl trans      drv     cty   hwy fl    class  
##    &lt;chr&gt;        &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;      &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;  
##  1 audi         a4           1.8  1999     4 auto(l5)   f        18    29 p     compact
##  2 audi         a4           1.8  1999     4 manual(m5) f        21    29 p     compact
##  3 audi         a4           2    2008     4 manual(m6) f        20    31 p     compact
##  4 audi         a4           2    2008     4 auto(av)   f        21    30 p     compact
##  5 audi         a4 quattro   1.8  1999     4 manual(m5) 4        18    26 p     compact
##  6 audi         a4 quattro   1.8  1999     4 auto(l5)   4        16    25 p     compact
##  7 audi         a4 quattro   2    2008     4 manual(m6) 4        20    28 p     compact
##  8 audi         a4 quattro   2    2008     4 auto(s6)   4        19    27 p     compact
##  9 chevrolet    malibu       2.4  1999     4 auto(l4)   f        19    27 r     midsize
## 10 chevrolet    malibu       2.4  2008     4 auto(l4)   f        22    30 r     midsize
## # ... with 71 more rows
```
]

.pull-right[

```r
mpg %&gt;% 
  filter(hwy &gt;= 22)
```

```
## # A tibble: 143 x 11
##    manufacturer model      displ  year   cyl trans      drv     cty   hwy fl    class  
##    &lt;chr&gt;        &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;      &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;  
##  1 audi         a4           1.8  1999     4 auto(l5)   f        18    29 p     compact
##  2 audi         a4           1.8  1999     4 manual(m5) f        21    29 p     compact
##  3 audi         a4           2    2008     4 manual(m6) f        20    31 p     compact
##  4 audi         a4           2    2008     4 auto(av)   f        21    30 p     compact
##  5 audi         a4           2.8  1999     6 auto(l5)   f        16    26 p     compact
##  6 audi         a4           2.8  1999     6 manual(m5) f        18    26 p     compact
##  7 audi         a4           3.1  2008     6 auto(av)   f        18    27 p     compact
##  8 audi         a4 quattro   1.8  1999     4 manual(m5) 4        18    26 p     compact
##  9 audi         a4 quattro   1.8  1999     4 auto(l5)   4        16    25 p     compact
## 10 audi         a4 quattro   2    2008     4 manual(m6) 4        20    28 p     compact
## # ... with 133 more rows
```
]

---

# `filter()` character

.pull-left[

```r
mpg %&gt;% 
  filter(manufacturer == "pontiac")
```

```
## # A tibble: 5 x 11
##   manufacturer model      displ  year   cyl trans    drv     cty   hwy fl    class  
##   &lt;chr&gt;        &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;    &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;  
## 1 pontiac      grand prix   3.1  1999     6 auto(l4) f        18    26 r     midsize
## 2 pontiac      grand prix   3.8  1999     6 auto(l4) f        16    26 p     midsize
## 3 pontiac      grand prix   3.8  1999     6 auto(l4) f        17    27 r     midsize
## 4 pontiac      grand prix   3.8  2008     6 auto(l4) f        18    28 r     midsize
## 5 pontiac      grand prix   5.3  2008     8 auto(s4) f        16    25 p     midsize
```
]

.pull-right[

```r
presidential %&gt;% 
  filter(party == "Democratic")
```

```
## # A tibble: 5 x 4
##   name    start      end        party     
##   &lt;chr&gt;   &lt;date&gt;     &lt;date&gt;     &lt;chr&gt;     
## 1 Kennedy 1961-01-20 1963-11-22 Democratic
## 2 Johnson 1963-11-22 1969-01-20 Democratic
## 3 Carter  1977-01-20 1981-01-20 Democratic
## 4 Clinton 1993-01-20 2001-01-20 Democratic
## 5 Obama   2009-01-20 2017-01-20 Democratic
```
]

---

# Democrats starting after 2000

`,` is equivalent to `&amp;`

.pull-left[

```r
presidential %&gt;% 
  filter(party == "Democratic" &amp; 
  start &gt; "2000-01-01")
```

```
## # A tibble: 1 x 4
##   name  start      end        party     
##   &lt;chr&gt; &lt;date&gt;     &lt;date&gt;     &lt;chr&gt;     
## 1 Obama 2009-01-20 2017-01-20 Democratic
```
]

.pull-right[

```r
presidential %&gt;% 
  filter(party == "Democratic", 
  start &gt; "2000-01-01")
```

```
## # A tibble: 1 x 4
##   name  start      end        party     
##   &lt;chr&gt; &lt;date&gt;     &lt;date&gt;     &lt;chr&gt;     
## 1 Obama 2009-01-20 2017-01-20 Democratic
```
]

---

# `filter` for Democrats

* note the use of `==` NOT `=`


```r
presidential %&gt;%
	filter(party == "Democratic")
```

```
## # A tibble: 5 x 4
##   name    start      end        party     
##   &lt;chr&gt;   &lt;date&gt;     &lt;date&gt;     &lt;chr&gt;     
## 1 Kennedy 1961-01-20 1963-11-22 Democratic
## 2 Johnson 1963-11-22 1969-01-20 Democratic
## 3 Carter  1977-01-20 1981-01-20 Democratic
## 4 Clinton 1993-01-20 2001-01-20 Democratic
## 5 Obama   2009-01-20 2017-01-20 Democratic
```

--


```r
presidential %&gt;%
	filter(party = "Democratic")
```

```
## Error: Problem with `filter()` input `..1`.
## x Input `..1` is named.
## i This usually means that you've used `=` instead of `==`.
## i Did you mean `party == "Democratic"`?
```

---

# `filter()` note

* The order of operations doesn’t work like English

* Can’t write 
  + `filter(presidential, name == “Kennedy” | “Johnson” `

* Must be 
  + `filter(presidential, name == “Kennedy” | name == “Johnson”)`

---

# more `filter()`


```r
head(reads, 4)
```

```
## # A tibble: 4 x 25
##   test_year        test_type test_site student_id pre_test_score pre_test_percent post_test_score post_test_percent percentage_chan~ unit_1_score
##   &lt;chr&gt;            &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;               &lt;dbl&gt; &lt;chr&gt;                      &lt;dbl&gt; &lt;chr&gt;             &lt;chr&gt;                   &lt;dbl&gt;
## 1 06/01/2016 12:0~ YEAR END  VIRDEN    Virden 1               43 29%                           92 61%               32%                         3
## 2 06/01/2016 12:0~ YEAR END  VIRDEN    Virden 2               46 31%                          104 69%               38%                         5
## 3 06/01/2016 12:0~ YEAR END  VIRDEN    Virden 3               39 26%                           75 50%               24%                         4
## 4 06/01/2016 12:0~ YEAR END  VIRDEN    Virden 4               35 23%                          115 77%               54%                         4
## # ... with 15 more variables: unit_1_percent &lt;chr&gt;, unit_2_score &lt;dbl&gt;, unit_2_percent &lt;chr&gt;, unit_3_score &lt;dbl&gt;, unit_3_percent &lt;chr&gt;,
## #   unit_4_score &lt;dbl&gt;, unit_4_percent &lt;chr&gt;, unit_5_6_score &lt;dbl&gt;, unit_5_6_percent &lt;chr&gt;, unit_7_score &lt;dbl&gt;, unit_7_percent &lt;chr&gt;,
## #   unit_8_score &lt;dbl&gt;, unit_8_percent &lt;chr&gt;, total_score &lt;dbl&gt;, total_percent_correct &lt;chr&gt;
```

--

* anamaly in the data

```r
reads %&gt;%
 count(student_id)
```

```
## # A tibble: 46 x 2
##    student_id                 n
##    &lt;chr&gt;                  &lt;int&gt;
##  1 All Students (Average)     3
##  2 Jones 1                    1
##  3 Jones 10                   1
##  4 Jones 11                   1
##  5 Jones 12                   1
##  6 Jones 13                   1
##  7 Jones 14                   1
##  8 Jones 15                   1
##  9 Jones 2                    1
## 10 Jones 3                    1
## # ... with 36 more rows
```

---

# Let's remove the aggregate rows


```r
students_only &lt;- reads %&gt;%
  filter(student_id != "All Students (Average)") 

students_only %&gt;% 
  count(student_id)
```

```
## # A tibble: 45 x 2
##    student_id     n
##    &lt;chr&gt;      &lt;int&gt;
##  1 Jones 1        1
##  2 Jones 10       1
##  3 Jones 11       1
##  4 Jones 12       1
##  5 Jones 13       1
##  6 Jones 14       1
##  7 Jones 15       1
##  8 Jones 2        1
##  9 Jones 3        1
## 10 Jones 4        1
## # ... with 35 more rows
```

---

# Chaining functions

What if we wanted to `select` and `filter` a data set?

* Select "name" and "party" of presidents who began their term after 2000

1. Two step method


```r
after_2000 &lt;- filter(presidential, start &gt; as.Date("2000-01-01"))
select(after_2000, name, party)
```

```
## # A tibble: 2 x 2
##   name  party     
##   &lt;chr&gt; &lt;chr&gt;     
## 1 Bush  Republican
## 2 Obama Democratic
```

---

# Chaining functions

* Alternatively, we could wrap `select` around `filter`


```r
select(filter(presidential, start &gt; as.Date("2000-01-01")), name, party)
```

```
## # A tibble: 2 x 2
##   name  party     
##   &lt;chr&gt; &lt;chr&gt;     
## 1 Bush  Republican
## 2 Obama Democratic
```

---

# Piping functions 🎉

* Or, we could use another function to help increase the readability of our code: 
&lt;br&gt;
`%&gt;%`
&lt;br&gt;

* Called the "pipe" operator and "piping functions"


```r
filter(presidential, start &gt; as.Date("2000-01-01")) %&gt;% 
  select(name, party)
```

```
## # A tibble: 2 x 2
##   name  party     
##   &lt;chr&gt; &lt;chr&gt;     
## 1 Bush  Republican
## 2 Obama Democratic
```

---

# Piping functions

Even better:

* Generally when using the pipe, the first argument is the data set, which gets piped through the corresponding functions
* So the code on the prior slide would be:


```r
presidential %&gt;% 
  filter(start &gt; as.Date("2000-01-01")) %&gt;% 
  select(name, party)
```

```
## # A tibble: 2 x 2
##   name  party     
##   &lt;chr&gt; &lt;chr&gt;     
## 1 Bush  Republican
## 2 Obama Democratic
```

.footnote[
Note the lovely indentations and line breaks to help keep things straight
]

---

# Some new data


```r
(prepost &lt;- reads %&gt;% 
  select(student_id, test_site, pre_test_score, post_test_score))
```

```
## # A tibble: 48 x 4
##    student_id test_site pre_test_score post_test_score
##    &lt;chr&gt;      &lt;chr&gt;              &lt;dbl&gt;           &lt;dbl&gt;
##  1 Virden 1   VIRDEN                43              92
##  2 Virden 2   VIRDEN                46             104
##  3 Virden 3   VIRDEN                39              75
##  4 Virden 4   VIRDEN                35             115
##  5 Virden 5   VIRDEN                46              85
##  6 Virden 6   VIRDEN                35              91
##  7 Virden 7   VIRDEN                40              96
##  8 Virden 8   VIRDEN                39              74
##  9 Virden 9   VIRDEN                40              90
## 10 Virden 10  VIRDEN                45              86
## # ... with 38 more rows
```

---

# `mutate()`

**Add** a variable


```r
prepost %&gt;% 
* mutate(gain = post_test_score - pre_test_score)
```

```
## # A tibble: 48 x 5
##    student_id test_site pre_test_score post_test_score  gain
##    &lt;chr&gt;      &lt;chr&gt;              &lt;dbl&gt;           &lt;dbl&gt; &lt;dbl&gt;
##  1 Virden 1   VIRDEN                43              92    49
##  2 Virden 2   VIRDEN                46             104    58
##  3 Virden 3   VIRDEN                39              75    36
##  4 Virden 4   VIRDEN                35             115    80
##  5 Virden 5   VIRDEN                46              85    39
##  6 Virden 6   VIRDEN                35              91    56
##  7 Virden 7   VIRDEN                40              96    56
##  8 Virden 8   VIRDEN                39              74    35
##  9 Virden 9   VIRDEN                40              90    50
## 10 Virden 10  VIRDEN                45              86    41
## # ... with 38 more rows
```

--


```r
names(prepost)
```

```
## [1] "student_id"      "test_site"       "pre_test_score"  "post_test_score"
```

---

# `mutate()`

**Add** *multiple* variables


```r
prepost &lt;- prepost %&gt;%
  mutate(
    gain = post_test_score - pre_test_score,
	  sum_tests = post_test_score + pre_test_score
  )
```

---

# `mutate()`

**Change** a variable


```r
prepost %&gt;% 
  mutate(sum_tests = (sum_tests/180) * 100)
```

```
## # A tibble: 48 x 6
##    student_id test_site pre_test_score post_test_score  gain sum_tests
##    &lt;chr&gt;      &lt;chr&gt;              &lt;dbl&gt;           &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
##  1 Virden 1   VIRDEN                43              92    49      75  
##  2 Virden 2   VIRDEN                46             104    58      83.3
##  3 Virden 3   VIRDEN                39              75    36      63.3
##  4 Virden 4   VIRDEN                35             115    80      83.3
##  5 Virden 5   VIRDEN                46              85    39      72.8
##  6 Virden 6   VIRDEN                35              91    56      70  
##  7 Virden 7   VIRDEN                40              96    56      75.6
##  8 Virden 8   VIRDEN                39              74    35      62.8
##  9 Virden 9   VIRDEN                40              90    50      72.2
## 10 Virden 10  VIRDEN                45              86    41      72.8
## # ... with 38 more rows
```

---

# `arrange()`

Order the data

* Order by *gain*, ascending [default]


```r
prepost %&gt;% 
  arrange(gain)
```

```
## # A tibble: 48 x 6
##    student_id  test_site pre_test_score post_test_score  gain sum_tests
##    &lt;chr&gt;       &lt;chr&gt;              &lt;dbl&gt;           &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
##  1 Jones 12    JONES                 27              32     5        59
##  2 Westside 6  WESTSIDE              57              82    25       139
##  3 Virden 8    VIRDEN                39              74    35       113
##  4 Virden 3    VIRDEN                39              75    36       114
##  5 Virden 5    VIRDEN                46              85    39       131
##  6 Virden 10   VIRDEN                45              86    41       131
##  7 Jones 3     JONES                 54              95    41       149
##  8 Virden 1    VIRDEN                43              92    49       135
##  9 Jones 13    JONES                 49              98    49       147
## 10 Westside 13 WESTSIDE              45              94    49       139
## # ... with 38 more rows
```

---

# `arrange()`

Order the data

* Order by *pre_test_score* and *gain* and, ascending


```r
prepost %&gt;% 
  arrange(pre_test_score, gain)
```

```
## # A tibble: 48 x 6
##    student_id test_site pre_test_score post_test_score  gain sum_tests
##    &lt;chr&gt;      &lt;chr&gt;              &lt;dbl&gt;           &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
##  1 Jones 11   JONES                 24             108    84       132
##  2 Jones 4    JONES                 25              99    74       124
##  3 Jones 12   JONES                 27              32     5        59
##  4 Virden 12  VIRDEN                31             102    71       133
##  5 Virden 11  VIRDEN                32              91    59       123
##  6 Virden 13  VIRDEN                33              86    53       119
##  7 Virden 6   VIRDEN                35              91    56       126
##  8 Virden 15  VIRDEN                35             101    66       136
##  9 Jones 9    JONES                 35             109    74       144
## 10 Virden 4   VIRDEN                35             115    80       150
## # ... with 38 more rows
```

---

# `arrange()`

Order the data

* Order by *gain*, **`desc`ending**


```r
prepost %&gt;% 
  arrange(desc(gain))
```

```
## # A tibble: 48 x 6
##    student_id test_site pre_test_score post_test_score  gain sum_tests
##    &lt;chr&gt;      &lt;chr&gt;              &lt;dbl&gt;           &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
##  1 Jones 11   JONES                 24             108    84       132
##  2 Virden 4   VIRDEN                35             115    80       150
##  3 Jones 4    JONES                 25              99    74       124
##  4 Jones 5    JONES                 36             110    74       146
##  5 Jones 9    JONES                 35             109    74       144
##  6 Virden 12  VIRDEN                31             102    71       133
##  7 Jones 1    JONES                 36             103    67       139
##  8 Virden 15  VIRDEN                35             101    66       136
##  9 Jones 6    JONES                 40             106    66       146
## 10 Westside 8 WESTSIDE              43             109    66       152
## # ... with 38 more rows
```

---

# `summarize()`

### or `summarise()`


* Here: compute the mean and standard deviation of the gain scores
* What are we looking at?


```r
prepost %&gt;% 
  summarize(mean_gain = mean(gain),
            sd_gain = sd(gain))
```

```
## # A tibble: 1 x 2
##   mean_gain sd_gain
##       &lt;dbl&gt;   &lt;dbl&gt;
## 1      56.3    13.6
```

---

# `group_by()`

&lt;div&gt;
    &lt;p style="float: right;"&gt;&lt;img src="https://swcarpentry.github.io/r-novice-gapminder/fig/13-dplyr-fig2.png" width="90%" height="90%"&gt;&lt;/p&gt;
    &lt;p&gt;&lt;b&gt;Conduct an operation by each level of a grouping factor&lt;/b&gt;&lt;/p&gt;
&lt;/div&gt;

* Here, compute the mean gain for each *test site*


```r
prepost %&gt;% 
  group_by(test_site) %&gt;% 
  summarize(mean_gain = mean(gain))
```

```
## # A tibble: 6 x 2
##   test_site    mean_gain
##   &lt;chr&gt;            &lt;dbl&gt;
## 1 JONES             59  
## 2 JONES ALL         59  
## 3 VIRDEN            53.8
## 4 VIRDEN ALL        53  
## 5 WESTSIDE          56.3
## 6 WESTSIDE ALL      56
```

.footnote[
Image from [Software Carpentry](https://swcarpentry.github.io/r-novice-gapminder/13-dplyr/)
]

---

# `group_by()`

When you use `group_by()` and `summarize()`

.pull-left[
* You will get a row for each unique group

```r
mpg %&gt;% 
  group_by(cyl) %&gt;% 
  summarize(max_hwy = max(hwy))
```

```
## # A tibble: 4 x 2
##     cyl max_hwy
##   &lt;int&gt;   &lt;int&gt;
## 1     4      44
## 2     5      29
## 3     6      29
## 4     8      26
```
]

--

.pull-right[
* If you have multiple grouping variables, you will get a row for each unique combination of groups

```r
mpg %&gt;% 
  group_by(cyl, drv) %&gt;% 
  summarize(max_hwy = max(hwy))
```

```
## # A tibble: 9 x 3
## # Groups:   cyl [4]
##     cyl drv   max_hwy
##   &lt;int&gt; &lt;chr&gt;   &lt;int&gt;
## 1     4 4          28
## 2     4 f          44
## 3     5 f          29
## 4     6 4          25
## 5     6 f          29
## 6     6 r          26
## 7     8 4          23
## 8     8 f          25
## 9     8 r          26
```
]

---

# Add summarized column to full data


```r
prepost %&gt;% 
  group_by(test_site) %&gt;% 
  mutate(mean_gain = mean(gain))
```

```
## # A tibble: 48 x 7
## # Groups:   test_site [6]
##    student_id test_site pre_test_score post_test_score  gain sum_tests mean_gain
##    &lt;chr&gt;      &lt;chr&gt;              &lt;dbl&gt;           &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
##  1 Virden 1   VIRDEN                43              92    49       135      53.8
##  2 Virden 2   VIRDEN                46             104    58       150      53.8
##  3 Virden 3   VIRDEN                39              75    36       114      53.8
##  4 Virden 4   VIRDEN                35             115    80       150      53.8
##  5 Virden 5   VIRDEN                46              85    39       131      53.8
##  6 Virden 6   VIRDEN                35              91    56       126      53.8
##  7 Virden 7   VIRDEN                40              96    56       136      53.8
##  8 Virden 8   VIRDEN                39              74    35       113      53.8
##  9 Virden 9   VIRDEN                40              90    50       130      53.8
## 10 Virden 10  VIRDEN                45              86    41       131      53.8
## # ... with 38 more rows
```

---
class: center, middle

&lt;img src="https://swcarpentry.github.io/r-novice-gapminder/fig/13-dplyr-fig3.png" width="50%" /&gt;

.footnote[
Image from [Software Carpentry](https://swcarpentry.github.io/r-novice-gapminder/13-dplyr/)
]

---

# Pipe to `{ggplot}`!


```r
prepost %&gt;% 
  group_by(test_site) %&gt;% 
  summarize(mean_gain = mean(gain)) %&gt;% 
  ggplot(aes(test_site, mean_gain)) +
  geom_col(fill = "cornflowerblue", alpha = .7)
```

&lt;img src="w4_dplyr_files/figure-html/unnamed-chunk-56-1.png" width="100%" /&gt;

---

background-size: contain

background-image: url("../images/kd.gif")

---

# Summarizing and Plotting

* Calculate means by test site


```r
students_only %&gt;%
    group_by(test_site) %&gt;%
    summarize(mean = mean(post_test_score))
```

```
## # A tibble: 3 x 2
##   test_site  mean
##   &lt;chr&gt;     &lt;dbl&gt;
## 1 JONES      97.8
## 2 VIRDEN     92.5
## 3 WESTSIDE  103.
```

---

# Plot it


```r
theme_set(theme_minimal(base_size = 18))

students_only %&gt;%
  group_by(test_site) %&gt;%
  summarize(mean = mean(post_test_score)) %&gt;%
  ggplot(aes(test_site, mean)) +
  geom_col(alpha = 0.8)
```

&lt;img src="w4_dplyr_files/figure-html/unnamed-chunk-58-1.png" width="100%" /&gt;

---
class: inverse, left, middle

# A couple more
## recode and rename

---

# Recode with `ifelse()`

Recoding into dichotomous variable with `ifelse()`

`ifelse(test, yes, no)`

*or*

`ifelse(logical statement, Do this IF TRUE, ELSE do this)`

---

# Recode with `ifelse()`

Recoding into dichotomous variable with `ifelse()`

**Remember to pair with `mutate()`**


```r
students_only %&gt;% 
  mutate(test_site = ifelse(test_site == "JONES", "district 1", "district 2"))
```

```
## # A tibble: 45 x 25
##    test_year       test_type test_site  student_id pre_test_score pre_test_percent post_test_score post_test_perce~ percentage_chan~ unit_1_score
##    &lt;chr&gt;           &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;               &lt;dbl&gt; &lt;chr&gt;                      &lt;dbl&gt; &lt;chr&gt;            &lt;chr&gt;                   &lt;dbl&gt;
##  1 06/01/2016 12:~ YEAR END  district 2 Virden 1               43 29%                           92 61%              32%                         3
##  2 06/01/2016 12:~ YEAR END  district 2 Virden 2               46 31%                          104 69%              38%                         5
##  3 06/01/2016 12:~ YEAR END  district 2 Virden 3               39 26%                           75 50%              24%                         4
##  4 06/01/2016 12:~ YEAR END  district 2 Virden 4               35 23%                          115 77%              54%                         4
##  5 06/01/2016 12:~ YEAR END  district 2 Virden 5               46 31%                           85 57%              26%                         2
##  6 06/01/2016 12:~ YEAR END  district 2 Virden 6               35 23%                           91 61%              38%                         5
##  7 06/01/2016 12:~ YEAR END  district 2 Virden 7               40 27%                           96 64%              37%                         5
##  8 06/01/2016 12:~ YEAR END  district 2 Virden 8               39 26%                           74 49%              23%                         4
##  9 06/01/2016 12:~ YEAR END  district 2 Virden 9               40 27%                           90 60%              33%                         6
## 10 06/01/2016 12:~ YEAR END  district 2 Virden 10              45 30%                           86 57%              27%                         4
## # ... with 35 more rows, and 15 more variables: unit_1_percent &lt;chr&gt;, unit_2_score &lt;dbl&gt;, unit_2_percent &lt;chr&gt;, unit_3_score &lt;dbl&gt;,
## #   unit_3_percent &lt;chr&gt;, unit_4_score &lt;dbl&gt;, unit_4_percent &lt;chr&gt;, unit_5_6_score &lt;dbl&gt;, unit_5_6_percent &lt;chr&gt;, unit_7_score &lt;dbl&gt;,
## #   unit_7_percent &lt;chr&gt;, unit_8_score &lt;dbl&gt;, unit_8_percent &lt;chr&gt;, total_score &lt;dbl&gt;, total_percent_correct &lt;chr&gt;
```

---

# Recode with `recode()`

Recoding into multinomial variable


```r
recode(variable,
       old_category_1 = "new_category_1",
	     old_category_2 = "new_category_3",
	     old_category_3 = "new_category_4",
       ...
)
```

---

# Recode with `recode()`

Recoding into multinomial variable

**Remember to pair with `mutate()`**


```r
students_only %&gt;% 
  mutate(test_site = recode(test_site,
                            JONES = "Jones Middle",
                            VIRDEN = "Virden Elementary",
                            WESTSIDE = "Westside High")
         )
```

```
## # A tibble: 45 x 25
##    test_year     test_type test_site    student_id pre_test_score pre_test_percent post_test_score post_test_perce~ percentage_chan~ unit_1_score
##    &lt;chr&gt;         &lt;chr&gt;     &lt;chr&gt;        &lt;chr&gt;               &lt;dbl&gt; &lt;chr&gt;                      &lt;dbl&gt; &lt;chr&gt;            &lt;chr&gt;                   &lt;dbl&gt;
##  1 06/01/2016 1~ YEAR END  Virden Elem~ Virden 1               43 29%                           92 61%              32%                         3
##  2 06/01/2016 1~ YEAR END  Virden Elem~ Virden 2               46 31%                          104 69%              38%                         5
##  3 06/01/2016 1~ YEAR END  Virden Elem~ Virden 3               39 26%                           75 50%              24%                         4
##  4 06/01/2016 1~ YEAR END  Virden Elem~ Virden 4               35 23%                          115 77%              54%                         4
##  5 06/01/2016 1~ YEAR END  Virden Elem~ Virden 5               46 31%                           85 57%              26%                         2
##  6 06/01/2016 1~ YEAR END  Virden Elem~ Virden 6               35 23%                           91 61%              38%                         5
##  7 06/01/2016 1~ YEAR END  Virden Elem~ Virden 7               40 27%                           96 64%              37%                         5
##  8 06/01/2016 1~ YEAR END  Virden Elem~ Virden 8               39 26%                           74 49%              23%                         4
##  9 06/01/2016 1~ YEAR END  Virden Elem~ Virden 9               40 27%                           90 60%              33%                         6
## 10 06/01/2016 1~ YEAR END  Virden Elem~ Virden 10              45 30%                           86 57%              27%                         4
## # ... with 35 more rows, and 15 more variables: unit_1_percent &lt;chr&gt;, unit_2_score &lt;dbl&gt;, unit_2_percent &lt;chr&gt;, unit_3_score &lt;dbl&gt;,
## #   unit_3_percent &lt;chr&gt;, unit_4_score &lt;dbl&gt;, unit_4_percent &lt;chr&gt;, unit_5_6_score &lt;dbl&gt;, unit_5_6_percent &lt;chr&gt;, unit_7_score &lt;dbl&gt;,
## #   unit_7_percent &lt;chr&gt;, unit_8_score &lt;dbl&gt;, unit_8_percent &lt;chr&gt;, total_score &lt;dbl&gt;, total_percent_correct &lt;chr&gt;
```

---

# Recode with `recode()`

Remember to use backticks for special characters


```r
mtcars %&gt;% 
  mutate(cyl_str = recode(cyl,
                      `4` = "cylinders4",
                      `6` = "cylinders6",
                      `8` = "cylinders8"))
```

---

# Recode with `case_when()`

Recoding across several variables, or if you find yourself using nested `ifelse()` statements


```r
penguins %&gt;% 
  mutate(species_big = 
           case_when(
             body_mass_g &gt; 4500 &amp; species == "Adelie" ~ "adelie_big",
             body_mass_g &gt; 4600 &amp; species == "Chinstrap" ~ "chinstrap_big",
             body_mass_g &gt; 6000 &amp; species == "Gentoo" ~ "gentoo_big",
             TRUE ~ "other"
           ))
```

--

* `TRUE` equivalent to `else` statement 
* **Remember to pair with `mutate()`**

---

# `rename()`

`rename(new_name = old_name)`


```r
penguins %&gt;%
  rename(
    home = island,
    bill_length = bill_length_mm
  )
```

--

**NOT paired with `mutate()`**

---

# rename with `select()`


```r
penguins %&gt;% 
  select(species, home = island, bill_length = bill_length_mm, year)
```

```
## # A tibble: 344 x 4
##    species home      bill_length  year
##    &lt;fct&gt;   &lt;fct&gt;           &lt;dbl&gt; &lt;int&gt;
##  1 Adelie  Torgersen        39.1  2007
##  2 Adelie  Torgersen        39.5  2007
##  3 Adelie  Torgersen        40.3  2007
##  4 Adelie  Torgersen        NA    2007
##  5 Adelie  Torgersen        36.7  2007
##  6 Adelie  Torgersen        39.3  2007
##  7 Adelie  Torgersen        38.9  2007
##  8 Adelie  Torgersen        39.2  2007
##  9 Adelie  Torgersen        34.1  2007
## 10 Adelie  Torgersen        42    2007
## # ... with 334 more rows
```

---

# Final notes on `{dplyr}`

* We could spend weeks on this
* We'll be using it all term long
* Verbs can help you gain fluency
* There are also conditional and all-inclusive versions of `mutate`, `select`, and `summarize`
  + [`across()`](https://dplyr.tidyverse.org/reference/across.html)


    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"ratio": "16:9",
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
