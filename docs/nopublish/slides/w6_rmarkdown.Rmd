---
title: "R Markdown"
subtitle: ""
author: "Joe Nese<br><span style = 'font-size: 50%;'>University of Oregon<br>Fall 2021</span>"
output:
  xaringan::moon_reader:
    css: xaringan-themer.css
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)

knitr::opts_chunk$set(echo = TRUE,
                      message = FALSE,
                      warning = FALSE)

library(xaringanthemer)
library(xaringanExtra)
library(tidyverse)
library(knitr)
library(here)
library(kableExtra)
library(gt)

```

```{r xaringan-themer, include=FALSE, warning=FALSE}
style_duo_accent(
  primary_color = "#1F4E79",
  secondary_color = "#0072B2",
  header_font_google = xaringanthemer::google_font("Atkinson Hyperlegible", "600"),
  text_font_google   = xaringanthemer::google_font("Atkinson Hyperlegible", "300", "300i"),
  code_font_google   = xaringanthemer::google_font("IBM Plex Mono"),
  colors = c(
    darkblue = "#0072B2",
    lightblue = "#56B4E9",
    darkorange = "#D55E00",
    lightorange = "#E69f00",
    yellow = "#F0E442",
    green = "#009E73",
    pink = "#CC79A7",
    gray = "999999",
    white = "#FFFFFF"
  )
)

```

```{r xaringanExtra-freezeframe, echo=FALSE}
xaringanExtra::use_freezeframe()
```

---
class: inverse, left, middle

# R Markdown
## Week 6

---

# Agenda

* R Markdown basics
* YAML options
* Chunk Options
* Global Options
* Inline Code

**Learning Objectives**
* Understand how to render R Markdown documents and mix code with text
* Understand different chunk options
* Understand inline code evaluation

---
# What is R Markdown?

* An authoring framework for data science
* A document format (.Rmd)
* An `R` package named `{rmarkdown}`
* A file format for making dynamic documents with `R`
* A tool for integrating prose, code, and results
* A computational document
* Everything

.footnote[
Credit [Allison Hill](https://apreshill.github.io/rmd4cdc/#12)
]

---
background-image: url(https://raw.githubusercontent.com/allisonhorst/stats-illustrations/master/rstats-artwork/rmarkdown_rockstar.png)
background-size: contain

---
background-image: url(https://raw.githubusercontent.com/allisonhorst/stats-illustrations/master/rstats-artwork/rmarkdown_wizards.png)
background-size: contain

---
background-image: url(https://raw.githubusercontent.com/allisonhorst/stats-illustrations/master/rstats-artwork/reproducibility_court.png)
background-size: contain

---
# Formats

* R Markdown will render to HTML and PDF really well 
* Word kinda-sorta supported
* You can also create websites, slides, books, etc.

---
# Distributions

You need a tex (pronounced tek) distribution 
* For this class, and probably everything you'll ever need: `{tinytex}`
<br>
`install.packages("tinytex")`
<br>
`tinytex::install_tinytex() `

**Full Distributions**
* Macs
  + MacTex: http://www.tug.org/mactex/
* PC
  + MikTex: https://miktex.org/download

---
# R Markdown

From within a RStudio Project, open a new R Markdown file

.pull-left[
```{r, echo=FALSE, out.width='50%'}
knitr::include_graphics("images/rmd_1.png")
```
]

--

.pull-right[
```{r, echo=FALSE, out.width='100%'}
knitr::include_graphics("images/rmd_2.png")
```
]

---

# Let's render!

```{r, echo=FALSE, out.width='100%'}
knitr::include_graphics("images/rmd_3.png")
```

---
## R Markdown input inline or in Viewer

```{r, echo=FALSE, out.width='100%'}
knitr::include_graphics("images/rmd_0.png")
```

---
# YAML Front Matter

```{r, eval=FALSE}
---
title: "World Changing Research"
author: "Joe Nese"
date: "2021-11-3"
---
```

* Yet Another Markup Language?
* Three dashes `---` before and after the YAML fields
* Case sensitive
* Format sensitive (spaces & tab)
* *Many* other fields are possible
  + For example, you may want to include an argument for `output:` `pdf_document`, `html_document`, `word_document`
  + Must be specified as it is rendered, if not supplied

---
## Syntax Highlighting

* The YAML will control a lot of how a document looks. 
* For example, if you wanted to render with a different [syntax highlighter](https://bookdown.org/yihui/rmarkdown/html-document.html)


.left-pull[
standard Rmd
```{r, eval=FALSE, echo=TRUE}
---
title: "Doc Title"
output: pdf_document
---
```

```{r, echo=FALSE, out.width='50%'}
knitr::include_graphics("images/rmd_10.png")
```
]

--

.right-pull[
`kate`
```{r, eval=FALSE, echo=TRUE}
---
title: "Doc Title"
output: 
  pdf_document:
    highlight: kate
---
```

```{r, echo=FALSE, out.width='50%'}
knitr::include_graphics("images/rmd_11.png")
```
]

---
## Table of Contents

* Specify a table of contents in the YAML
* A table of contents will be automatically generated for you based on your **headers**

\# Header 1
<br>
\#\# Header 2

```{r, eval=FALSE}
---
output: 
  html_document:
    toc: true
---
```

---
## Table of Contents - change depth

* By default, the TOC will only go down to 3 levels
* Change that with `toc_depth:`

```{r, eval=FALSE}
---
output: 
  html_document:
    toc: true
    toc_depth: 5
---
```

---
## Table of Contents - float it

* For **HTML documents**, allow the TOC to float along the side as you scroll

```{r, eval=FALSE}
---
output: 
  html_document:
    toc: true
    toc_depth: 5
    toc_float: true
---
```

---
## Code Folding

* Provide a button for people to be able to see the code, but otherwise have it hidden

```{r, eval=FALSE}
---
output: 
  html_document:
    toc: true
    toc_depth: 5
    toc_float: true
    code_folding: hide
---
```

.darkorange[[Bean Experiment .Rmd]]

---
# Code Chunks vs. Text

```{r, echo=FALSE, out.height='50%'}
knitr::include_graphics("images/rmd_4.png")
```

---
# Code chunks

Start a code chunk with ````{r} `
* then produce some `R` code

then close the chunk with three additional back ticks ```` `

````
```{r cars}`r ''`
a <- 22
b <- 7

a / b
```
````

--

One of my favorite shortcuts is to insert a code chunk

PC: `Ctrl + Alt + I`

Mac: `Command + Alt + I`

---
# Chunk Names

* Use single word: `chunk1`
* Or use hyphen (`-`) to separate words: `chunk-1` 
* Do **not** use spaces: `chunk 1`
* Do **not** use underscore `chunk_1`

--

Think kebabs, not snakes
* `bar-plot-1`
* `bar-plot-2`
* `hist-plot-1`
* `model-1`

.footnote[
[Allison Hill](https://apreshill.github.io/rmd4cdc/#100)
]

---
# Headings and Lists

.pull-left[
```{r, echo=FALSE, out.width='70%'}
knitr::include_graphics("images/rmd_5.png")
```
]

.pull-left[
```{r, echo=FALSE, out.width='60%'}
knitr::include_graphics("images/rmd_6.png")
```
]

.footnote[
**\*** not an `R` vector list
]

---
.pull-left[
```{r, echo=FALSE, out.width='100%'}
knitr::include_graphics("images/rmd_7.png")
```
]

.pull-left[
```{r, echo=FALSE, out.width='100%'}
knitr::include_graphics("images/rmd_8.png")
```
]

---
# More Advanced Options

* chunk options
* setting global options
* inline code evaluation

---
class: inverse, left, middle

# Chunk Options

---
# A Few Chunk Options

```{r, echo=FALSE}

(chunkopts1 <- tibble::tribble(
   ~Options,                         ~Arguments, ~Default,                               ~Result,
     "`eval`",                          "logical",   "`TRUE`",                  "Evaluate the code?",
     "`echo`",                          "logical",   "`TRUE`",                      "Show the code?",
  "`results`", "'markup', 'asis', 'hold', 'hide'", "`markup`",                  "Render the results",
  "`warning`",                          "logical",   "`TRUE`",                     "Print warnings?",
    "`error`",                          "logical",   "`TRUE`",   "Preserve errors? (if `FALSE`, quit)",
  "`message`",                          "logical",   "`TRUE`",                 "Print any messages?",
  "`include`",                          "logical",   "`TRUE`", "Include any of the code or results?",
     "`tidy`",                          "logical",  "`FALSE`",    "Tidy code? (see` {formatR}` package)"
  ) %>% 
  gt() %>%
  fmt_markdown(columns = everything()) %>% 
  tab_style(
    style = list(
      cell_fill(color = "white")
      ),
    locations = cells_body(
      rows = everything())
  )
)
```

---
# A Few Chunk Options

```{r, echo=FALSE}
chunkopts1 %>% 
  tab_style(
    style = list(
      cell_fill(color = "#F0E442")
      ),
    locations = cells_body(
      rows = 1)
  )
```

---
# A Few Chunk Options

```{r, echo=FALSE}
chunkopts1 %>% 
  tab_style(
    style = list(
      cell_fill(color = "#F0E442")
      ),
    locations = cells_body(
      rows = 2)
  )
```

---
# A Few Chunk Options

```{r, echo=FALSE}
chunkopts1 %>% 
  tab_style(
    style = list(
      cell_fill(color = "#F0E442")
      ),
    locations = cells_body(
      rows = 3)
  )
```

.footnote[
`results = 'asis'` for rendering tables!
]

---
# A Few Chunk Options

```{r, echo=FALSE}
chunkopts1 %>% 
  tab_style(
    style = list(
      cell_fill(color = "#F0E442")
      ),
    locations = cells_body(
      rows = 4)
  )
```

---
# A Few Chunk Options

```{r, echo=FALSE}
chunkopts1 %>% 
  tab_style(
    style = list(
      cell_fill(color = "#F0E442")
      ),
    locations = cells_body(
      rows = 5)
  )
```

---
# A Few Chunk Options

```{r, echo=FALSE}
chunkopts1 %>% 
  tab_style(
    style = list(
      cell_fill(color = "#F0E442")
      ),
    locations = cells_body(
      rows = 6)
  )
```

---
# A Few Chunk Options

```{r, echo=FALSE}
chunkopts1 %>% 
  tab_style(
    style = list(
      cell_fill(color = "#F0E442")
      ),
    locations = cells_body(
      rows = 7)
  )
```

---
# And a Few More

```{r, echo=FALSE}
(chunkopts2 <- tibble::tribble(
                ~Options,                  ~Arguments, ~Default,                                        ~Result,
                 "`cache`",              "logical, 0:3",  "`FALSE`",                           "Cache code chunks?",
        "`cache.comments`",                   "logical",   "`NULL`",        "Cache invalidated by comment changes?",
             "`dependson`",                 "char, num",   "`NULL`", "Current chunk depend on prior cached chunks?",
               "`autodep`",                   "logical",  "`FALSE`",            "Depends determined automatically?",
  "`fig.height`/`fig.width`",                   "numeric",   "`7, 7`",                   "Height and width of figure",
              "`fig.show`", "asis, hold, animate, hide",   "`asis`",           "How the figure should be displayed",
              "`interval`",                   "numeric",      "`1`",                                "Animate speed",
                 "`cache`",              "logical, 0:3",  "`FALSE`",                           "Cache code chunks?"
  ) %>% 
  gt() %>%
  fmt_markdown(columns = everything()) %>% 
  tab_style(
    style = list(
      cell_fill(color = "white")
      ),
    locations = cells_body(
      rows = everything())
  )
)
```

---
# And a Few More

```{r, echo=FALSE}
chunkopts2 %>% 
  tab_style(
    style = list(
      cell_fill(color = "#F0E442")
      ),
    locations = cells_body(
      rows = 5)
  )
```

---

## `echo` and `eval`

.pull-left[
### `echo = FALSE`
evaluate code without showing it

Text here...
````r
```{r echo = FALSE}`r ''`
a <- 22
a / 7
```
````

more text here

----

Text here...
```{r, echo=FALSE}
a <- 22
a / 7
```

more text here

]

--

.pull-right[
### `eval = FALSE`
show code without evaluating it

Text here...
````r
```{r echo = FALSE}`r ''`
a <- 22
a / 7
```
````

more text here

----

Text here...
```{r, eval=FALSE}
a <- 22
a / 7
```

more text here

]

---
## `warning = FALSE`

Warning is printed to the console when rendering

````r
```{r warning=FALSE}`r ''`
ggplot(msleep, aes(sleep_rem, sleep_total)) + 
  geom_point()
```
````

```{r echo=FALSE, warning=FALSE}
ggplot(msleep, aes(sleep_rem, sleep_total)) + 
  geom_point()
```

---
## `warning = TRUE`


````r
```{r warning=TRUE}`r ''`
ggplot(msleep, aes(sleep_rem, sleep_total)) + 
  geom_point()
```
````

```{r echo=FALSE, warning=TRUE}
ggplot(msleep, aes(sleep_rem, sleep_total)) + 
  geom_point()
```

---
## `error = TRUE`

This will show errors in the rendered document

````r
```{r error=TRUE}`r ''`
ggplot(msleep, aes(sleep_rem, sleep_total)) + 
  geom_point()
```
````

```{r, error=TRUE, echo=FALSE, fig.height=5}
ggplot(msleep, aes(sleep_rem, sleep_total)) + 
  geom_point()
```

---
## `error = FALSE`

The document won't render if it encounters an error

````r
```{r error=FALSE}`r ''`
ggplot(msleep, aes(sleep_rem, sleep_total)) + 
  geom_point()
```
````

```{r, echo=FALSE, out.height='80%'}
knitr::include_graphics("images/rmd_9.png")
```

---
## `message = TRUE`

````r
```{r message=TRUE}`r ''`
ggplot(msleep, aes(sleep_rem, sleep_total)) + 
  geom_point()
```
````

```{r, echo=FALSE, message=TRUE, fig.height=5}
ggplot(msleep, aes(sleep_rem, sleep_total)) + 
  geom_point()
```

## `message = FALSE`

Some functions will return messages that you may want to suppress

````r
```{r message=FALSE}`r ''`
ggplot(msleep, aes(sleep_total)) + 
  geom_histogram()
```
````

```{r, echo=FALSE, message=FALSE}
ggplot(msleep, aes(sleep_total)) + 
  geom_histogram()
```

---
## `include`

The `include` argument is used to evaluate code that is not included in the document, and neither are the results of that code
* `include=FALSE` : won’t show code or results
  + For example, when setting up your **global options**, often the first chunk in your .Rmd is:

````r
```{r setup, include=FALSE}`r ''`
knitr::opts_chunks$set(echo = TRUE,
                       message = FALSE,
                       warning = FALSE)
```
````

--

Note the chunk name is `setup`

`knitr::opts_chunk$set()` sets the **global options** for the entire script

---
class: inverse, left, middle

# Global Options

---
# Setting global options

* Change the default behavior for all code chunks in the script

`opts_chunk$set(…)`

* For example, you can set `echo=FALSE` and `fig.width=6.5` and `fig.height=8`

`opts_chunk$set(echo = FALSE, fig.width = 6.5, fig.height = 8)`

* This is most useful when producing a report for somebody who doesn't use `R` and has no use for, or knowledge of, the code

* You can always override the global options within a particular chunk, e.g.

````r
```{r chunk-name, echo=TRUE}`r ''`

```
````

---
## Other global settings to consider

* `warnings = FALSE`
* `message = FALSE`
* `error = TRUE`
* `echo = FALSE`

````r
```{r setup, include=FALSE}`r ''`
knitr::opts_chunks$set(echo = FALSE,
                       message = FALSE,
                       warning = FALSE,
                       errors)
```
````

---
class: inverse, left, middle

# Inline Code

---
# Inline R Code

Two back ticks that enclose the letter "r" produce inline code to be evaluated

This is **extremely** useful in writing reports. Never have to update any numbers in text, regardless of changes to your models or data (if you are careful about it).

````r
```{r echo=FALSE}`r ''`
a <- 22
b <- 7
```
````

```{r, echo=FALSE}
a <- 22
b <- 7
```

This is an example of inline code where I want to refer to the sum of a and b, which is `` `r '\x60r a + b\x60'` `` 
<br>
<br>

This is an example of inline code where I want to refer to the sum of a and b, which is `r a + b`

---
# Real Example

.darkorange[[Bean Experiment .Rmd]]

---
class: inverse, left, middle

# Formatting Prose

---
# Inline Formatting

* *Italics*
  + single asterisk  \**italicized text*\*
  + single underscore \_ _italicized text_\_
* **Bold**
  + double asterisks \*\***bold**\*\*
  + double underscores \_\_ __bold__\_\_
* Inline code
  + back ticks `` `code` ``
  + Similar to inline code specification, without specifying the language `` `r ` ``

---
# Escaping

Sometimes you may not want the formatting to occur, and instead just show what you've typed
* For example, you want to type a hashtag, and not have it be a Header
<br>
Escape with `\`

\\# I escape the pound symbol to print this

\# I escape the pound symbol to print this

---
# [Tabbed Sections](https://bookdown.org/yihui/rmarkdown/html-document.html#tabbed-sections)

* Organize content by adding `{.tabset}` to your header
* This will make all sub-headers of that header to appear as tabs
* `.tabset-pills` will make the tabs appear as pills

.pull-left[
````r
# Tabs!

## Research Results {.tabset}

### Grade 1
Grade 1 results here!

### Grade 2
Here are the figures and tables for Grade 2!

### Grade 3
Now you are seeing Grade 3 stuff!
````
]

.pull-right[
```{r, echo=FALSE, out.height='80%'}
knitr::include_graphics("images/rmd_12.png")
```
]

---
class: inverse, left, middle

# Citations
### R Markdown

---
# Citations in .Rmd

To include references in your .Rmd, you must:

* Create an external `.bib` file using LaTeX formatting
  + (use RStudio to open new Text File)
* Include `bibliography: nameOfYourBibFile.bib` in your YAML
* Refer to the citations in text using `@`

---
# Citations in .Rmd .darkorange[[demo]]

1. Open a new Rmd document
2. In your YAML, add a new line for `bibliography:` followed by the name of your bibliography file, which should be in the same directory, and should be the bare name (i.e., not quotes)
  + `bibliography: references.bib`
3. Open a text file, save it with a `.bib` extension
  + `references.bib`
4. Go to google Scholar and find a reference to cite. Copy and paste the citation into your `.bib` file using Google's cite option
5. Include a reference to the citation in your Rmd file
6. Include a page break so your citations are on a separate page (\newpage)
  + only when rendering in PDF
  + Note this is not APA, but references are included automatically at the end of the document. 
7. Include `# References` as the last line of your document to give it a title
8. Render as PDF

---
# Citations in .Rmd .darkorange[[demo]]

.1. Open a new Rmd document

.2. In your YAML, add a new line for `bibliography:` followed by the name of your bibliography file, which should be in the same directory, and should be the bare name (i.e., not quotes)
  + `bibliography: references.bib`

```{r, eval=FALSE}
---
title: "Bibliography example"
author: "Joe Nese"
output: pdf_document
bibliography: references.bib
---
```

.3. Open a text file, save it as `references.bib` 

---
# Citations in .Rmd .darkorange[[demo]]

.4. Find the references to cite
  + You can copy/paste the citation into your .bib file using Google's cite option
  + You can (and should!) cite the `R` packages you use

.5. Include a reference to the citation in your .Rmd file 

.6. Include a page break so your citations are on a separate page (`\newpage`)
  + Note this is not APA format, but references are included automatically at the end of the document 

.7. Add `# References` as the last line of your document to give it a title

.8. Render as PDF

---
# Other options

* [`{citr}`](https://github.com/crsh/citr)
  + a GUI interface
* [Zotero](https://blog.rstudio.com/2020/11/09/rstudio-1-4-preview-citations/#citations-from-zotero)
* [DOI](https://blog.rstudio.com/2020/11/09/rstudio-1-4-preview-citations/#citations-from-dois)

---
class: inverse, left, middle

# Tables

---
# Table Chunk Options

For tables, you may have to specify `results = 'asis'` or you can end up with wacky display

````r
```{r chunk-name, results = 'asis'}`r ''`

```
````




