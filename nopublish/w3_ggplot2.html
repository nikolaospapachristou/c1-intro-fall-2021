<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Week 3: Data Visualization</title>
    <meta charset="utf-8" />
    <meta name="author" content="Joe Nese" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/panelset/panelset.css" rel="stylesheet" />
    <script src="libs/panelset/panelset.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Week 3: Data Visualization
## <code>{ggplot2}</code>
### Joe Nese
### University of Oregon
### Fall 2021

---








---
class: inverse, left, middle

# Data Visualization with `{ggplot2}`
## Week 3

---

# Agenda

*

**Overall Purpose**

* 

---
class: inverse, left, middle

# Share! 

---

# [`{datapasta}`](https://github.com/MilesMcBain/datapasta)

* Copy and paste data to and from R
* VERY handy!
* Good for [reprex](https://github.com/tidyverse/reprex) 
  + posting questions on Rstudio Community or stackoverflow

**.darkorange[[demo]]**

---

background-size: contain

background-image: url("https://www.tidyverse.org/images/tidyverse-default.png")

---

# Providing grammar for:

* Graphics 
  + `{ggplot2}`
* Data manipulations 
  + `{dplyr}`
  + `{tidyr}`
* Expanding area of specialized topics
  + `{lubridate}`
  + `{glue}`
  + `{tidymodels}`
* Many more...

---

# Providing grammar for:

* Graphics 
  + .lightblue.bg-yellow[`{ggplot2}`]
* Data manipulations
  + `{dplyr}`
  + `{tidyr}`
* Expanding area of specialized topics
  + `{lubridate}`
  + `{glue}`
  + `{tidymodels}`
* Many more...


---
class: inverse, left, middle

# `{ggplot2}`

---

# The `{ggplot2}` package

`gg` stands for the "grammar of graphics"

.pull-left[
[![](https://ggplot2-book.org/cover.jpg)](https://ggplot2-book.org/)
]

.pull-right[
[![](https://images-us.bookshop.org/ingram/9780387245447.jpg?height=500&amp;v=v2)](https://bookshop.org/books/the-grammar-of-graphics/9780387245447)
]

---

# Resources

The `{ggplot2}` package is one of the most popular `R` packages, and there are many resources to learn the syntax 
* ggplot2 book (email me for digital copy)
* RStudio [cheat sheet](https://raw.githubusercontent.com/rstudio/cheatsheets/master/data-visualization.pdf)
  + Can be helpful, perhaps more so after a little experience
* [R Graphics Cookbook](http://www.cookbook-r.com/Graphs/)
* [R Graph Gallery](https://www.r-graph-gallery.com/index.html)

---

# Components

**Every ggplot plot has three components**

1. data
  + the `data` used to produce the plot
2. aesthetic mappings (`aes`)
  + between variables and visual properties 
3. layer(s) 
  + usually through the `geom_*()` function to produce geometric shapes to be rendered

--

**`{ggplot}` always takes a data frame (tibble) as the first argument**

---

# Basic syntax

.darkorange[`ggplot(`].darkblue[`data`]`,` .green[`aes(`] x = `xvar, y = yvar`.green[`)`].darkorange[`)`] .lightblue[`+`]&lt;br&gt;
&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;nbsp;.lightorange[`geom_*()`]

--

.darkorange[`ggplot()`] = the function is `ggplot` and the package is `{ggplot2}` 

--

.darkblue[`data`] = the data to be plotted

--

.green[`aes(`] x = `xvar, y = yvar`.green[`)`] = the `aes`thetic mappings

--

.lightorange[`geom_*()`] = the `geom`etrics of the plot; the `*` here represents any of the geom offerings

--

.footnote[
.lightblue[`+`] = note the `+` and &lt;ins&gt;NOT&lt;/ins&gt; the `%&gt;%`
]

---

# `{ggplot2}` template

ggplot(.green["data"], aes(.green["mappings"])) + &lt;br&gt;
&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;.green["geom_*function*"]()

---

# Some data for today

&lt;div&gt;
    &lt;p style="float: right;"&gt;&lt;img src="https://allisonhorst.github.io/palmerpenguins/reference/figures/lter_penguins.png" height="100"&gt;&lt;/p&gt;
    &lt;p&gt;&lt;i&gt;penguins&lt;/i&gt; from {palmerpenguins}&lt;/p&gt;
&lt;/div&gt;

.darkorange[[run the following]]


```r
library(tidyverse)
library(palmerpenguins)

head(penguins)
```

```
## # A tibble: 6 x 8
##   species island bill_length_mm bill_depth_mm flipper_length_~ body_mass_g sex  
##   &lt;chr&gt;   &lt;chr&gt;           &lt;dbl&gt;         &lt;dbl&gt;            &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt;
## 1 Adelie  Torge~           39.1          18.7              181        3750 male 
## 2 Adelie  Torge~           39.5          17.4              186        3800 fema~
## 3 Adelie  Torge~           40.3          18                195        3250 fema~
## 4 Adelie  Torge~           NA            NA                 NA          NA &lt;NA&gt; 
## 5 Adelie  Torge~           36.7          19.3              193        3450 fema~
## 6 Adelie  Torge~           39.3          20.6              190        3650 male 
## # ... with 1 more variable: year &lt;dbl&gt;
```

---
class: inverse, left, middle

# Continuous Data

---

# Setting up a plot

Run the following code. What do you see?

.pull-left[

```r
ggplot(penguins, aes(bill_length_mm, body_mass_g)) 
```
]

--

.pull-right[
![](w3_ggplot2_files/figure-html/unnamed-chunk-2-1.png)&lt;!-- --&gt;
]

--

It's ready for you to add some `geom`etric &lt;ins&gt;layers&lt;/ins&gt;...what should we add?

---

# How about points?

 

.pull-left[

```r
ggplot(penguins, aes(bill_length_mm, body_mass_g)) +
* geom_point()
```
]

.pull-right[
![](w3_ggplot2_files/figure-html/unnamed-chunk-3-1.png)&lt;!-- --&gt;
]

---

# Adding layers

* In the previous slide, we added a layer of points
* The `geom_point()` layer is a function, complete with it's own arguments

--


* Let’s change the color of the points

How would you change the color of the points? 
	
&amp;emsp;&amp;emsp;&lt;ins&gt;or&lt;/ins&gt; 

How would you find out about changing the color of the points?

---

# Color

 

.pull-left[

```r
ggplot(penguins, aes(bill_length_mm, body_mass_g)) +
* geom_point(color = "magenta")
```
]

.pull-right[
![](w3_ggplot2_files/figure-html/unnamed-chunk-4-1.png)&lt;!-- --&gt;
]

---

# Add another layer

Let's add a smoothed line with `geom_smooth()`

.pull-left[

```r
ggplot(penguins, aes(bill_length_mm, body_mass_g)) +
  geom_point(color = "magenta") + 
* geom_smooth()
```
]

.pull-right[
![](w3_ggplot2_files/figure-html/unnamed-chunk-5-1.png)&lt;!-- --&gt;
]

---

# You try

You probably got the note below when you ran (defaults)


```r
ggplot(penguins, aes(bill_length_mm, body_mass_g)) +
  geom_point(color = "magenta") + 
  geom_smooth()
```

```
## `geom_smooth()` using method = 'loess' and formula 'y ~ x'
```

--

Change the `method` to `"lm"`

---

# Let's do this together

Look at the help page – `?geom_smooth` 

1. Remove the confidence interval around the line

2. Now change the SE band to reflect a 68% confidence interval

---

# Global vs. conditional `color`

Prior examples changed colors globally
- `geom_point(color = "magenta")`

Use `aes()` to access variables, and color according to a specific variable
- We use variable names within `aes()`

Let’s check the data again (`head()`) and the "species" variable (`table()`) 

.darkorange[[let's do this together]]

---

.pull-left[

```r
ggplot(penguins, aes(bill_length_mm, body_mass_g)) +
* geom_point(aes(color = species))
```
]

.pull-right[
![](w3_ggplot2_files/figure-html/unnamed-chunk-6-1.png)&lt;!-- --&gt;
]

---

# Global vs. Conditional `color`


```r
ggplot(penguins, aes(bill_length_mm, body_mass_g)) +
  geom_point(aes(color = species))
```

* When we did `geom_point(color = "magenta")` we put quotes around the color 
* Why now is "species" not in quotes?

--
* color names/hex codes are in quotes **NOT** in the `aes()`
* variable names are in the `aes()` **NOT** in quotes

---

## Conditional flow through layers

If we use something like `color = “x”` in the first `aes`thetic, it will carry on through all additional layers

* These two codes are the same:


```r
ggplot(penguins, aes(bill_length_mm, body_mass_g)) +
  geom_point(aes(color = species))
```


```r
ggplot(penguins, aes(bill_length_mm, body_mass_g, color = species)) +
  geom_point()
```

--

* But these two are not...why? .darkorange[[run to find out]]


```r
ggplot(penguins, aes(bill_length_mm, body_mass_g)) +
  geom_point(aes(color = species)) + 
  geom_smooth()
```


```r
ggplot(penguins, aes(bill_length_mm, body_mass_g, color = species)) +
  geom_point() + 
  geom_smooth()
```

---

# Be mindful with `aes()`

Using `aes()` when you **don't** need it

What is happening here?


```r
ggplot(penguins, aes(bill_length_mm, body_mass_g)) +
  geom_point(aes(color = "blue")) + 
  geom_smooth()
```

![](w3_ggplot2_files/figure-html/unnamed-chunk-12-1.png)&lt;!-- --&gt;

---

# Be mindful with `aes()`

**Not** using `aes()` when you need it

What is happening here?

```{r. fig.height=4}
ggplot(penguins, aes(bill_length_mm, body_mass_g)) +
  geom_point(aes(color = species)) + 
  geom_smooth()
```

--

.footnote[
Not a very helpful error message, by the way.
]

---
class: inverse, left, middle

# Themes

---

# Let's talk themes

* The default is `theme_gray`
  + I don't like it
* But there are a lot of build-in alternative in `{ggplot2}`
  + `theme_minimal` is my favorite
* Check out the [`{ggthemes}`](https://yutannihilation.github.io/allYourFigureAreBelongToUs/ggthemes/) package for a lot of alternatives
  + These days I nearly always use the [`colorblind`](https://yutannihilation.github.io/allYourFigureAreBelongToUs/ggthemes/colorblind/) theme for discrete values in my plots
* Check out the [`{ggthemeassist}`](https://github.com/calligross/ggthemeassist) add-in

---

# More themes

* The [`{hrbrthemes}`](https://github.com/hrbrmstr/hrbrthemes) are nice
* Consider [building your own theme!](https://bookdown.org/rdpeng/RProgDA/building-a-new-theme.html)
* Or Google around

--

* Set the theme globally
  + One of the first lines in your .rmd file could be:
  
`theme_set(theme_minimal())`

---

# Get a little fancy

* You can use `geom_point()` for more than one layer
* You can also use a different data source on a layer
* Use these two properties to highlight points
  + How about penguins from Torgersen Island?

---


```r
ggplot(penguins, aes(bill_length_mm, body_mass_g)) +
  geom_point(color = "black")
```

![](w3_ggplot2_files/figure-html/unnamed-chunk-13-1.png)&lt;!-- --&gt;

---


```r
ggplot(penguins, aes(bill_length_mm, body_mass_g)) +
  geom_point(color = "black") + 
* geom_point(data = dplyr::filter(penguins, island == "Torgersen"), color = "magenta")
```

![](w3_ggplot2_files/figure-html/unnamed-chunk-14-1.png)&lt;!-- --&gt;

---


```r
ggplot(penguins, aes(bill_length_mm, body_mass_g)) +
  geom_point(color = "black") + 
  geom_point(data = dplyr::filter(penguins, island == "Torgersen"), color = "magenta") + 
* geom_smooth(se = FALSE)
```

![](w3_ggplot2_files/figure-html/unnamed-chunk-15-1.png)&lt;!-- --&gt;

---


```r
ggplot(penguins, aes(bill_length_mm, body_mass_g)) +
  geom_point(color = "black") + 
  geom_point(data = dplyr::filter(penguins, island == "Torgersen"), color = "magenta") + 
  geom_smooth(se = FALSE) + 
* theme_minimal()
```

![](w3_ggplot2_files/figure-html/unnamed-chunk-16-1.png)&lt;!-- --&gt;

---

# Another option

`{gghighlight}` varying flexibility


```r
ggplot(penguins, aes(bill_length_mm, body_mass_g)) +
  geom_point(color = "magenta") + 
  gghighlight::gghighlight(island == "Torgersen") + 
  theme_minimal()
```

![](w3_ggplot2_files/figure-html/unnamed-chunk-17-1.png)&lt;!-- --&gt;

---

# Line plots

* When should you use line plots instead of smooths?
--

  + usually when time is involved
--

* What are some good candidate data for line plots?
--

  + observed versus model-implied (estimated)

---

# `geom_line()`

Classic time series example 

*economics* data from `{ggplot2}`


```r
economics
```

```
## # A tibble: 574 x 6
##    date         pce    pop psavert uempmed unemploy
##    &lt;date&gt;     &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
##  1 1967-07-01  507. 198712    12.6     4.5     2944
##  2 1967-08-01  510. 198911    12.6     4.7     2945
##  3 1967-09-01  516. 199113    11.9     4.6     2958
##  4 1967-10-01  512. 199311    12.9     4.9     3143
##  5 1967-11-01  517. 199498    12.8     4.7     3066
##  6 1967-12-01  525. 199657    11.8     4.8     3018
##  7 1968-01-01  531. 199808    11.7     5.1     2878
##  8 1968-02-01  534. 199920    12.3     4.5     3001
##  9 1968-03-01  544. 200056    11.7     4.1     2877
## 10 1968-04-01  544  200208    12.3     4.6     2709
## # ... with 564 more rows
```

---

# Let's try it

How do you think we'd fit a line plot to these data, showing unemployment ("unemploy") over time?

--


```r
ggplot(economics, aes(date, unemploy)) +
  geom_line()
```

![](w3_ggplot2_files/figure-html/unnamed-chunk-19-1.png)&lt;!-- --&gt;

---

# Layers

What happens when we layer geom_line and geom_point?


```r
ggplot(economics, aes(date, unemploy)) +
  geom_line() +
  geom_point()
```

.darkorange[try it!]

--

Not the best instance of this 
It would work better on a plot with fewer time points, but you get the idea

---
class: inverse, left, middle

# Labels

---

# Axis Labels

.pull-left[

```r
ggplot(economics, aes(date, unemploy)) +
  geom_line() +
  theme_minimal() +
* labs(x = "Date",
*      y = "Unemployment")
```
]

.pull-right[
![](w3_ggplot2_files/figure-html/unnamed-chunk-21-1.png)&lt;!-- --&gt;
]

---

# Axis Labels

.pull-left[

```r
ggplot(economics, aes(date, unemploy)) +
  geom_line() +
  theme_minimal() +
  labs(x = "Date", 
       y = "Unemployment",
*      title = "Unemployment Over Time")
```
]

.pull-right[
![](w3_ggplot2_files/figure-html/unnamed-chunk-22-1.png)&lt;!-- --&gt;
]

---

# Axis Labels

.pull-left[

```r
ggplot(economics, aes(date, unemploy)) +
  geom_line() +
  theme_minimal() +
  labs(x = "Date", 
       y = "Unemployment",
       title = "Unemployment Over Time",
*      subtitle = "This is the subtitle")
```
]

.pull-right[
![](w3_ggplot2_files/figure-html/unnamed-chunk-23-1.png)&lt;!-- --&gt;
]

---

# Axis Labels

.pull-left[

```r
ggplot(economics, aes(date, unemploy)) +
  geom_line() +
  theme_minimal() +
  labs(x = "Date", 
       y = "Unemployment",
       title = "Unemployment Over Time",
       subtitle = "This is the subtitle",
*      caption = "Created by Joe Nese")
```
]

.pull-right[
![](w3_ggplot2_files/figure-html/unnamed-chunk-24-1.png)&lt;!-- --&gt;
]


---

# Axis Labels

.pull-left[

```r
ggplot(economics, aes(date, unemploy)) +
  geom_line() +
  theme_minimal() +
  labs(x = "Date", 
       y = "Unemployment",
       title = "Unemployment Over Time",
       subtitle = "This is the subtitle",
       caption = "Created by Joe Nese",
*      tag = "(A)")
```
]

.pull-right[
![](w3_ggplot2_files/figure-html/unnamed-chunk-25-1.png)&lt;!-- --&gt;
]

---

# Axis Labels

.pull-left[

```r
ggplot(penguins, aes(bill_length_mm, body_mass_g, color = species)) + # 'color = '
  geom_point() +
  theme_minimal() +
  labs(x = "Bill Length (mm)",
       y = "Body Mass (g)",
       color = "Species") # 'color = '
```
]

.pull-right[
![](w3_ggplot2_files/figure-html/unnamed-chunk-26-1.png)&lt;!-- --&gt;
]

---
class: inverse, left, middle

# Facets

---

# Faceting

* One of the most powerful features of `{ggplot}`
* Produce *n* plots by a specific variable

* `facet_wrap()`
  + wrap a sequence of panels into two dimensions
  + based on variables(s)
---

# Faceting

.pull-left[

```r
ggplot(penguins, aes(bill_length_mm, body_mass_g)) + 
  geom_point() +
  geom_smooth() +
  facet_wrap(~species)
```
]

.pull-right[
![](w3_ggplot2_files/figure-html/unnamed-chunk-27-1.png)&lt;!-- --&gt;
]

---

# Careful about `~`


```r
ggplot(penguins, aes(bill_length_mm, body_mass_g)) + 
  geom_point() +
  geom_smooth() +
  facet_wrap(species)
```

---

# Faceting 


```r
ggplot(penguins, aes(bill_length_mm, body_mass_g)) + 
  geom_point() +
  geom_smooth() +
  facet_wrap(species ~ year)
```

```
## `geom_smooth()` using method = 'loess' and formula 'y ~ x'
```

```
## Warning: Removed 2 rows containing non-finite values (stat_smooth).
```

```
## Warning: Removed 2 rows containing missing values (geom_point).
```

![](w3_ggplot2_files/figure-html/unnamed-chunk-29-1.png)&lt;!-- --&gt;

---

# Alternative specification


```r
ggplot(penguins, aes(bill_length_mm, body_mass_g)) + 
  geom_point() +
  geom_smooth() +
  facet_wrap(vars(species))
```


```r
ggplot(penguins, aes(bill_length_mm, body_mass_g)) + 
  geom_point() +
  geom_smooth() +
  facet_wrap(vars(species, year))
```

---
class: inverse, left, middle

# Categorical Data

---

# Data

`{fivethirtyeight}` package
- *college_grad_students*


```r
#install.packages("fivethirtyeight")
library(fivethirtyeight)
# View(college_grad_students)
d &lt;- college_grad_students # simpler reference
d
```

```
## # A tibble: 173 x 22
##    major_code major    major_category  grad_total grad_sample_size grad_employed
##         &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;                &lt;int&gt;            &lt;int&gt;         &lt;int&gt;
##  1       5601 Constru~ Industrial Art~       9173              200          7098
##  2       6004 Commerc~ Arts                 53864              882         40492
##  3       6211 Hospita~ Business             24417              437         18368
##  4       2201 Cosmeto~ Industrial Art~       5411               72          3590
##  5       2001 Communi~ Computers &amp; Ma~       9109              171          7512
##  6       3201 Court R~ Law &amp; Public P~       1542               22          1008
##  7       6206 Marketi~ Business            190996             3738        151570
##  8       1101 Agricul~ Agriculture &amp; ~      17488              386         13104
##  9       2101 Compute~ Computers &amp; Ma~       5611               98          4716
## 10       1904 Adverti~ Communications~      33928              688         28517
## # ... with 163 more rows, and 16 more variables:
## #   grad_employed_fulltime_yearround &lt;int&gt;, grad_unemployed &lt;int&gt;,
## #   grad_unemployment_rate &lt;dbl&gt;, grad_p25th &lt;dbl&gt;, grad_median &lt;dbl&gt;,
## #   grad_p75th &lt;int&gt;, nongrad_total &lt;int&gt;, nongrad_employed &lt;int&gt;,
## #   nongrad_employed_fulltime_yearround &lt;int&gt;, nongrad_unemployed &lt;int&gt;,
## #   nongrad_unemployment_rate &lt;dbl&gt;, nongrad_p25th &lt;dbl&gt;, nongrad_median &lt;dbl&gt;,
## #   nongrad_p75th &lt;dbl&gt;, grad_share &lt;dbl&gt;, grad_premium &lt;dbl&gt;
```

```r
theme_set(theme_minimal(base_size = 16))
```

---

# Histogram

Histogram of "grad_total"


```r
ggplot(d, aes(x = grad_total)) +
  geom_histogram()
```

![](w3_ggplot2_files/figure-html/unnamed-chunk-33-1.png)&lt;!-- --&gt;

---

# Transparency - `alpha`

Add some transparency – perhaps this looks nicer


```r
ggplot(d, aes(x = grad_total)) +
* geom_histogram(alpha = 0.7)
```

![](w3_ggplot2_files/figure-html/unnamed-chunk-34-1.png)&lt;!-- --&gt;

---

# `color` vs. `fill`

**In general**
* `color` defines the color a geom is *outlined*
* `fill` defines the color a geom is *filled* 

For example:
* `geom_point()` default has only has a color and **NO** fill because they're just points
* Point shapes 21–24 include both a color and a fill


```r
knitr::include_graphics("https://ggplot2.tidyverse.org/reference/scale_shape.html 
")
```

![](https://ggplot2.tidyverse.org/reference/scale_shape.html 
)&lt;!-- --&gt;

---

## How would we change the color of this plot?


```r
ggplot(d, aes(x = grad_total)) +
  geom_histogram(alpha = 0.7)
```

--


```r
ggplot(d, aes(x = grad_total)) +
  geom_histogram(alpha = 0.7, color = "magenta")
```

![](w3_ggplot2_files/figure-html/unnamed-chunk-37-1.png)&lt;!-- --&gt;

---

## How would we change the color of this plot?


```r
ggplot(d, aes(x = grad_total)) +
  geom_histogram(alpha = 0.7)
```

--


```r
ggplot(d, aes(x = grad_total)) +
  geom_histogram(alpha = 0.7, fill = "magenta")
```

![](w3_ggplot2_files/figure-html/unnamed-chunk-39-1.png)&lt;!-- --&gt;

---

# Color by variable

What if we wanted different colors by major_category


```r
ggplot(d, aes(x = grad_total)) +
  geom_histogram(aes(fill = major_category), alpha = 0.7)
```

![](w3_ggplot2_files/figure-html/unnamed-chunk-40-1.png)&lt;!-- --&gt;

---

# Density plot

Alternative representation of distribution

* Think of it as a smoothed histogram (uses kernel smoothing)
* The depiction of the distribution is **NOT** determined by the number of the bins you use, as are histograms

---

# Density plot

`geom_density()`


```r
ggplot(d, aes(x = grad_total)) +
  geom_density()
```

![](w3_ggplot2_files/figure-html/unnamed-chunk-41-1.png)&lt;!-- --&gt;

---

# Density plot

`geom_density()`

Now let’s fill by major_category


```r
ggplot(d, aes(x = grad_total)) +
  geom_density(aes(fill = major_category), alpha = 0.2)
```

![](w3_ggplot2_files/figure-html/unnamed-chunk-42-1.png)&lt;!-- --&gt;

--

.footnote[
Not a good plot, just an example
]

---

## Possible alternative? `facet_wrap`



```r
ggplot(d, aes(x = grad_total)) +
  geom_density(alpha = 0.2) +
  facet_wrap(~major_category)
```

![](w3_ggplot2_files/figure-html/unnamed-chunk-43-1.png)&lt;!-- --&gt;

---

# Even better

## density ridges


```r
library(ggridges)
ggplot(d, aes(x = grad_total, y = major_category)) +
  geom_density_ridges()
```

![](w3_ggplot2_files/figure-html/unnamed-chunk-44-1.png)&lt;!-- --&gt;

---

# Density  Ridges


```r
ggplot(penguins, aes(bill_length_mm , species)) +
  geom_density_ridges()
```

![](w3_ggplot2_files/figure-html/unnamed-chunk-45-1.png)&lt;!-- --&gt;

---

# `fill` 


```r
ggplot(penguins, aes(bill_length_mm , species)) +
  geom_density_ridges(aes(fill = factor(year)))
```

![](w3_ggplot2_files/figure-html/unnamed-chunk-46-1.png)&lt;!-- --&gt;

---

# Add transparency for clarity


```r
ggplot(penguins, aes(bill_length_mm , species)) +
  geom_density_ridges(aes(fill = factor(year)),
*                     alpha = 0.7)
```

![](w3_ggplot2_files/figure-html/unnamed-chunk-47-1.png)&lt;!-- --&gt;

---

# Viridis


```r
ggplot(penguins, aes(bill_length_mm , species)) +
  geom_density_ridges(aes(fill = factor(year)),
                      alpha = 0.7) +
*                     scale_fill_viridis_d()
```

![](w3_ggplot2_files/figure-html/unnamed-chunk-48-1.png)&lt;!-- --&gt;

---

# Same fill function, different option


```r
ggplot(penguins, aes(bill_length_mm , species)) +
  geom_density_ridges(aes(fill = factor(year)),
                      alpha = 0.7) +
*                     scale_fill_viridis_d(option = "plasma")
```

![](w3_ggplot2_files/figure-html/unnamed-chunk-49-1.png)&lt;!-- --&gt;

---

## Candy rankings `{fivethirtyeight}`


```r
candy &lt;- candy_rankings %&gt;% 
  pivot_longer(
    cols = chocolate:pluribus,
    names_to = "type",
    values_to = "foo") %&gt;% 
  filter(foo) %&gt;% 
  select(-foo)
candy
```

```
## # A tibble: 197 x 5
##    competitorname sugarpercent pricepercent winpercent type            
##    &lt;chr&gt;                 &lt;dbl&gt;        &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;           
##  1 100 Grand             0.732        0.860       67.0 chocolate       
##  2 100 Grand             0.732        0.860       67.0 caramel         
##  3 100 Grand             0.732        0.860       67.0 crispedricewafer
##  4 100 Grand             0.732        0.860       67.0 bar             
##  5 3 Musketeers          0.604        0.511       67.6 chocolate       
##  6 3 Musketeers          0.604        0.511       67.6 nougat          
##  7 3 Musketeers          0.604        0.511       67.6 bar             
##  8 Air Heads             0.906        0.511       52.3 fruity          
##  9 Almond Joy            0.465        0.767       50.3 chocolate       
## 10 Almond Joy            0.465        0.767       50.3 peanutyalmondy  
## # ... with 187 more rows
```

---

# Boxplot


```r
ggplot(candy, aes(type, sugarpercent)) +
  geom_boxplot() 
```

![](w3_ggplot2_files/figure-html/unnamed-chunk-51-1.png)&lt;!-- --&gt;

---

# Violin plots


```r
ggplot(candy, aes(type, sugarpercent)) +
  geom_violin() 
```

![](w3_ggplot2_files/figure-html/unnamed-chunk-52-1.png)&lt;!-- --&gt;

---

# Heatmaps

&gt; A heatmap is a literal way of visualizing a table of numbers, where you substitute the numbers with colored cells.
  -- Nathan Yau

* Useful for finding highs and lows  - and sometimes patterns
* They don't always work well

---

# Example with correlations


```r
corr &lt;- cor(mtcars)

pc &lt;- corr %&gt;% 
  as.data.frame() %&gt;% 
  mutate(row = rownames(.)) %&gt;% 
  pivot_longer(
    cols = -row,
    names_to = "col",
    values_to = "cor"
  )
head(pc)
```

```
## # A tibble: 6 x 3
##   row   col      cor
##   &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;
## 1 mpg   mpg    1    
## 2 mpg   cyl   -0.852
## 3 mpg   disp  -0.848
## 4 mpg   hp    -0.776
## 5 mpg   drat   0.681
## 6 mpg   wt    -0.868
```

---


```r
ggplot(pc, aes(row, col, fill = cor)) +
  geom_tile()
```

![](w3_ggplot2_files/figure-html/unnamed-chunk-54-1.png)&lt;!-- --&gt;

---


```r
ggplot(pc, aes(row, col, fill = cor)) +
  geom_tile() +
* scale_fill_viridis_c()
```

![](w3_ggplot2_files/figure-html/unnamed-chunk-55-1.png)&lt;!-- --&gt;

---

# Bar Charts

.pull-left[
**`{geom_bar()}`**
* expects *x* **OR** *y*
* counts rows
* if you want to count the number of cases at each *x* or *y* position 
* makes the height of the bar proportional to the number of cases in each group
* uses `stat_count()` by default
]

.pull-right[
**`{geom_col()}`**
* expects *x* **AND** *y*
* expects numbers in your data
* if you want the heights of the bars to represent values in the data
* leaves the data as is
* uses `stat_identity()` by default
]

---

# Bar chart


```r
ggplot(mpg, aes(class)) + # one variable in the `aes()`
  geom_bar() # counts the rows per class
```

![](w3_ggplot2_files/figure-html/unnamed-chunk-56-1.png)&lt;!-- --&gt;

---

.pull-left[

```r
head(mpg)
```

```
## # A tibble: 6 x 11
##   manufacturer model displ  year   cyl trans      drv     cty   hwy fl    class 
##   &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;      &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; 
## 1 audi         a4      1.8  1999     4 auto(l5)   f        18    29 p     compa~
## 2 audi         a4      1.8  1999     4 manual(m5) f        21    29 p     compa~
## 3 audi         a4      2    2008     4 manual(m6) f        20    31 p     compa~
## 4 audi         a4      2    2008     4 auto(av)   f        21    30 p     compa~
## 5 audi         a4      2.8  1999     6 auto(l5)   f        16    26 p     compa~
## 6 audi         a4      2.8  1999     6 manual(m5) f        18    26 p     compa~
```

]

.pull-right[

```r
summarized_mpg &lt;- mpg %&gt;% 
  group_by(class) %&gt;% 
  count()

head(summarized_mpg)
```

```
## # A tibble: 6 x 2
## # Groups:   class [6]
##   class          n
##   &lt;chr&gt;      &lt;int&gt;
## 1 2seater        5
## 2 compact       47
## 3 midsize       41
## 4 minivan       11
## 5 pickup        33
## 6 subcompact    35
```
]

---

# `geom_col()`


```r
ggplot(summarized_mpg, aes(class, n)) + # two variables in the `aes()`
  geom_col() # data has the rows per class in "n"
```

![](w3_ggplot2_files/figure-html/unnamed-chunk-59-1.png)&lt;!-- --&gt;

---

.pull-left[
### `geom_bar()` default

```r
ggplot(mpg, aes(class)) + 
  geom_bar()
```

![](w3_ggplot2_files/figure-html/unnamed-chunk-60-1.png)&lt;!-- --&gt;
]

--
### `geom_bar(stat = "identity")` 
.pull-right[

```r
ggplot(summarized_mpg, aes(class, n)) + 
  geom_bar(stat = "identity")
```

![](w3_ggplot2_files/figure-html/unnamed-chunk-61-1.png)&lt;!-- --&gt;
]

---

.pull-left[
### `geom_bar()` default

```r
ggplot(mpg, aes(class)) + 
  geom_bar()
```

![](w3_ggplot2_files/figure-html/unnamed-chunk-62-1.png)&lt;!-- --&gt;
]

.pull-right[
### `geom_col()` default

```r
ggplot(summarized_mpg, aes(class, n)) + 
  geom_col()
```

![](w3_ggplot2_files/figure-html/unnamed-chunk-63-1.png)&lt;!-- --&gt;
]

---

.pull-left[
### `geom_bar()` default

```r
ggplot(mpg, aes(class)) + 
  geom_bar()
```

![](w3_ggplot2_files/figure-html/unnamed-chunk-64-1.png)&lt;!-- --&gt;
]

.pull-right[
### `geom_bar()` uh-oh

```r
ggplot(summarized_mpg, aes(class)) + 
  geom_bar()
```

![](w3_ggplot2_files/figure-html/unnamed-chunk-65-1.png)&lt;!-- --&gt;
]

--

# What happened?

Let's look at our data again


```r
summarized_mpg
```

```
## # A tibble: 7 x 2
## # Groups:   class [7]
##   class          n
##   &lt;chr&gt;      &lt;int&gt;
## 1 2seater        5
## 2 compact       47
## 3 midsize       41
## 4 minivan       11
## 5 pickup        33
## 6 subcompact    35
## 7 suv           62
```

---

.left-pull[

```r
h_mileage &lt;- mpg %&gt;% 
  group_by(class) %&gt;% 
  summarize(mean_hwy = mean(hwy)) 
```
]

--

.right-pull[

```r
h_mileage %&gt;% 
  ggplot(aes(class, mean_hwy)) + 
  geom_col()
```

![](w3_ggplot2_files/figure-html/unnamed-chunk-68-1.png)&lt;!-- --&gt;
]

---

# Change the order of the *x*-axis

* We'll talk about automated methods more later
* Basically - define *x*-axis variable as a factor with levels in the order you want

--

.left-pull[

```r
mpg_new &lt;- mpg %&gt;% 
  mutate(class = factor(class,
                        levels = c("pickup",
                                   "suv",
                                   "minivan",
                                   "2seater",
                                   "midsize",
                                   "subcompact",
                                   "compact")))
```
]

--

.right-pull[

```r
h_mileage %&gt;% 
  ggplot(aes(class, mean_hwy)) + 
  geom_col()
```

![](w3_ggplot2_files/figure-html/unnamed-chunk-70-1.png)&lt;!-- --&gt;
]

---

# More boxplot options

Data


```r
eclsk &lt;- haven::read_sav(here::here("data", "ecls-k_samp.sav")) %&gt;% 
  rio::characterize() %&gt;% 
  janitor::clean_names()

ecls_smry &lt;- eclsk %&gt;%
    group_by(k_type, ethnic) %&gt;%
    summarize(t1r_mean = mean(t1rscale))

ecls_smry
```

```
## # A tibble: 16 x 3
## # Groups:   k_type [2]
##    k_type   ethnic                                  t1r_mean
##    &lt;chr&gt;    &lt;chr&gt;                                      &lt;dbl&gt;
##  1 full-day AMERICAN INDIAN OR ALASKA NATIVE            17.5
##  2 full-day ASIAN                                       31.8
##  3 full-day BLACK OR AFRICAN AMERICAN, NON-HISPANIC     21.1
##  4 full-day HISPANIC, RACE NOT SPECIFIED                20.3
##  5 full-day HISPANIC, RACE SPECIFIED                    22.3
##  6 full-day MORE THAN ONE RACE, NON HISPANIC            20.8
##  7 full-day NATIVE HAWAIIAN, OTHER PACIFIC ISLANDER     23.2
##  8 full-day WHITE, NON-HISPANIC                         25.5
##  9 half-day AMERICAN INDIAN OR ALASKA NATIVE            30.0
## 10 half-day ASIAN                                       25.1
## 11 half-day BLACK OR AFRICAN AMERICAN, NON-HISPANIC     18.6
## 12 half-day HISPANIC, RACE NOT SPECIFIED                18.7
## 13 half-day HISPANIC, RACE SPECIFIED                    20.0
## 14 half-day MORE THAN ONE RACE, NON HISPANIC            20.3
## 15 half-day NATIVE HAWAIIAN, OTHER PACIFIC ISLANDER     19.7
## 16 half-day WHITE, NON-HISPANIC                         23.7
```

---

# Stacked bar plot

Look for effects in "ethnicity" by "k_type" (full/half day K)


```r
ggplot(ecls_smry, aes(ethnic, t1r_mean)) +
    geom_col(aes(fill = k_type))
```

![](w3_ggplot2_files/figure-html/unnamed-chunk-72-1.png)&lt;!-- --&gt;

---

# Grouped bar plot

 


```r
ggplot(ecls_smry, aes(ethnic, t1r_mean)) +
    geom_col(aes(fill = k_type),
*            position = "dodge")
```

![](w3_ggplot2_files/figure-html/unnamed-chunk-73-1.png)&lt;!-- --&gt;

---

# Rotating Labels

I have to look [this](https://stackoverflow.com/questions/1330989/rotating-and-spacing-axis-labels-in-ggplot2) up *every* time


```r
ggplot(ecls_smry, aes(ethnic, t1r_mean)) +
  geom_col(aes(fill = k_type),
           position = "dodge") +
* theme(axis.text.x = element_text(angle = 90, hjust = 1))
```

![](w3_ggplot2_files/figure-html/unnamed-chunk-74-1.png)&lt;!-- --&gt;

---

# Flip the coordinates

`coord_flip()`


```r
ggplot(ecls_smry, aes(ethnic, t1r_mean)) +
  geom_col(aes(fill = k_type),
           position = "dodge") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
* coord_flip()
```

![](w3_ggplot2_files/figure-html/unnamed-chunk-75-1.png)&lt;!-- --&gt;

---

# Alternatively

`facet_wrap()`


```r
ggplot(ecls_smry, aes(k_type, t1r_mean)) +
    geom_col(alpha = 0.8) +
    facet_wrap(~ethnic)
```

![](w3_ggplot2_files/figure-html/unnamed-chunk-76-1.png)&lt;!-- --&gt;

---

# Sometimes some redundancy works well


```r
ggplot(ecls_smry, aes(k_type, t1r_mean, fill = k_type)) +
    geom_col(alpha = 0.8) +
    facet_wrap(~ethnic)
```

![](w3_ggplot2_files/figure-html/unnamed-chunk-77-1.png)&lt;!-- --&gt;

---

# `geom_*()` Review

`geom_point()`
`geom_smooth()`
`geom_line()`
`geom_histogram()`
`geom_density()`
`ggridges::geom_density_ridges()`
`geom_boxplot()`
`geom_violin()`
`geom_tile()`
`geom_bar()`
`geom_col()`

---

# Challenge

#!! Probably not!

* Start a new `R` project
* Create a new script, save it as "practice-plots.R"
* Load the `{tidyverse}`
* Print the **msleep** dataset to see it's structure (it's from `{ggplot2}`)

For each of the following, produce a separate plot

1. Plot the relation between "sleep_total" and "brainwt" (with "brainwt" as the DV) - scatter plot
2. Overlay a smooth on the prior plot
3. Color the points by "vore", but fit a single smooth
4. Fit separate smooths by "vore", but with all points being gray
5. Omit the standard error of the smooths
6. Use ylim as an additional layer to restrict the y-axis to range from 0 to 5


    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
